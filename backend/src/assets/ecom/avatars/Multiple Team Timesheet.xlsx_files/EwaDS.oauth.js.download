(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1051:function(A,F,b){b.d(F,"a",function(){return a});A=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(A.b)("SupportStatus",a)},1398:function(A,F,b){function a(ba){var T=la.call(this)||this;T.$=ba;T.dc();return T}
function c(ba){this.oAuthManager=ba}function e(){}function l(ba){this.bUb=ba}function n(){}function m(){}b.r(F);A=b(0);var f=b(13),x=b(981),y=b(1051),t=b(5),B=b(95),z=b(857),u=b(273),C=b(47),r=b(23),J=b(86),v=b(338);m.prototype.ji=function(ba){ba.register(825,"Common.App.OAuth.IOAuthManager").Bc().Lc(function(){return new x.OAuthManager})};m.prototype.init=function(){var ba=J.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.hPj(ba)};m.prototype.hPj=function(ba){var T=t.AFrameworkApplication.ga.Ua("FileSource");
if(t.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||t.AFrameworkApplication.ga.ra("IsO365CommercialHost")||"WopiTest"===T){var H=z.a.uGh,S=z.a.authority;if(void 0!==H&&null!==H&&H.length&&void 0!==S&&null!==S&&S.length){var K=y.a[ba.YS],da=r.a.yGa,fa=ba.Qu();try{var X=new Map;void 0!==X&&null!==X?(X.set("SupportStatus",K),X.set("Browser",da),X.set("AuthStrategy",fa)):X=null}catch(ja){X=null}B.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",X);var ca=C.a.we();ba.FS("Core",
H).then(function(ja){var ea=Math.floor(C.a.we()-ca);K=y.a[ba.YS];da=r.a.yGa;fa=ba.Qu();f.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',ea,ja.IsSuccess,K,ja.ErrorCode,T,da,fa);X&&(X.set("SupportStatus",K),X.set("Browser",da),X.set("AuthStrategy",fa));ea=Object.assign(new v.a,{durationMs:ea,extendedProperties:X});ja.IsSuccess?B.Health.instance.recordKpiSuccess("WacCorePFT",
ea):B.Health.instance.recordKpiFailure("WacCorePFT",ja.ErrorCode,!1,!1,ea)})}}};m.prototype.dispose=function(){};m.main=function(){u.a.instance.sj(new m)};Sk.Object.defineProperties(m.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(A.a)(m,"OAuthPackage",null,[4,5]);var D=b(1078);Object(A.a)(n,"LokiTokenResult",null,[]);l.prototype.Jfd=function(){var ba=this,T=this.yTh();return T?l.Bpd?new Promise(function(H,S){ba.bUb.continueWith(function(){ba.bUb.Ih||
ba.bUb.kg?S(Error.create("Error downloading auth library")):ba.bUb.result.FS("Loki",T).then(function(K){K=t.AFrameworkApplication.ga.ra("ForceLokiFallbackToACLPTokenIsEnabled")?ba.BTh():K.IsSuccess&&K.Token?Object.assign(new n,{isSuccess:!0,token:K.Token,errorMessage:null}):Object.assign(new n,{isSuccess:!1,token:null,errorMessage:JSON.stringify(K)});H(K);return K})})}):Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):
Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",D.a.VXe())}))};l.prototype.BTh=function(){var ba=t.AFrameworkApplication.ga.Ua("LokiUserDataSignature")||"";return Object.assign(new n,{isSuccess:!0,token:ba,errorMessage:null})};l.prototype.yTh=function(){var ba=null,T=D.a.S$b();2===T?ba=t.AFrameworkApplication.ga.Ua("LokiAADAppId"):1===T&&(ba=t.AFrameworkApplication.ga.Ua("LokiMSAAppId"));return ba};Sk.Object.defineProperties(l,
{Bpd:{configurable:!0,enumerable:!0,get:function(){return t.AFrameworkApplication.ga.ra("IsO365CommercialHost")||t.AFrameworkApplication.ga.ra("IsO365ConsumerHost")}}});Object(A.a)(l,"LokiTokenManager",null,[843]);var V=b(525);e.prototype.init=function(){J.a.instance.resolve("Common.ILokiTokenManager")};e.prototype.dispose=function(){};e.prototype.ji=function(ba){ba.register(l,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Bc().Lc(function(){return new l(V.a.Tq(ba.oc("Common.App.OAuth.IOAuthManager")))})};
e.main=function(){u.a.instance.sj(new e)};Sk.Object.defineProperties(e.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(A.a)(e,"LivePersonaUtilsPackage",null,[4,5]);var U=b(10);F=b(214);var Q=b(946);c.prototype.FS=function(ba,T){return this.oAuthManager?this.oAuthManager.FS(ba,T).then(function(H){H.IsSuccess||f.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+H.ErrorMessage+" Error code: "+H.ErrorCode+" App name: "+
ba);return Object.assign(new Q.a,{IsSuccess:H.IsSuccess,Token:H.Token,ErrorCode:H.ErrorCode,ErrorMessage:H.ErrorMessage})}):(f.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object.assign(new Q.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};c.prototype.TLa=function(){return this.oAuthManager?this.oAuthManager.TLa():null};Object(A.a)(c,"OAuthManagerWrapper",null,[841]);var la=F.a;vm(a,la);a.prototype.create=
function(){this.Fb(this.$.da.Aa(349)||new c(J.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ja=function(ba){ba.da.Ha(350,new a(ba))};Object(A.a)(a,"OAuthManagerFactory",F.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");m.main();Type.registerNamespace("Common.App.LivePersonaUtils");e.main();(function(){U.a.Ga(function(ba){a.ja(ba)})})()},981:function(A,F,b){function a(Ha){var Xa=this;Ha=void 0===Ha?
null:Ha;this.YS=0;this.oP=null;this.Yug=0;var Na=ea.a.we();this.Bqg=this.neh(Ha).then(function(db){return db?Xa.p$h():(u.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",Xa.Qu(),Math.floor(ea.a.we()-Na)),db=ja.a.Wr(),void 0!==db&&null!==db&&(db.set("AuthLibrary",Xa.Qu()),db=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.we()-Na),extendedProperties:db}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",
!1,!0,db)),Promise.resolve(1))}).then(function(db){return 0!==db?Promise.resolve(db):Xa.jti()})}function c(Ha){this.pPc=Ha;this.HXa="UnsupportedAuthTokenStrategy Reason="+r.a[this.pPc]}function e(){this.Hs=null;this.uSb=0;this.Mjb=this.UXa=this.cFc=this.HDa=this.kM=this.aje=null;this.zv=new X.a(null,null);this.eXb=D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.HXa="SharedAuthTokenStrategy "+(this.eXb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":
"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.kY=V.a.Dwj;this.$ge=V.a.Cwj;this.X5d=V.a.enableConsoleLogging;this.mog=D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Iwg=D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.eXb);this.Yqa={};this.Mqg=new m(1500)}function l(Ha,Xa,Na,db,Ja,jb,hc){var ma=fa.call(this,!1,!1,!0)||this;ma.B1=null;ma.l5d=null;ma.kY=Ha;ma.pug=Na;ma.zv=db;
ma.jyg=Ja;ma.HDa=jb;ma.Hs=document.createElement("iframe");ma.Hs.id="SharedAuthInteractiveFrame";ma.Hs.setAttribute("name","SharedAuthInteractiveFrame");ma.Hs.setAttribute("title","SharedAuthInteractiveFrame");ma.Hs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");ma.Hs.style.border="0";ma.Hs.style.height="48px";ma.Hs.style.width="190px";$addHandler(ma.Hs,"error",Object(la.a)(ma,ma.bTi,"onSharedAuthFrameError"));Ha=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",ma.kY,
Xa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",D.AFrameworkApplication.userType);hc&&(Ha+="&vnext=1");ma.Hs.src=Ha;ma.Sng=new Promise(function(Ka){ma.l5d=Ka});ma.m5d=!1;return ma}function n(){this.correlationId=this.resolve=null}function m(Ha){Ha=void 0===Ha?0:Ha;this.IB=0;this.Fkb=!1;this.wm=new T.a;this._timeout=Ha}function f(){this.reject=this.resolve=null;this.startTime=0;this.KKf=this.Nte=null}function x(){this.ake=null;var Ha=D.AFrameworkApplication.ga.Ua(D.AFrameworkApplication.Aea),
Xa=D.AFrameworkApplication.ga.Ua(D.AFrameworkApplication.Dbg);this.HXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",Ha&&""!==Ha?Ha:"Unspecified",Xa&&""!==Xa?Xa:"Unspecified")}function y(Ha,Xa,Na,db,Ja){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=Ha;this.scope=Xa;this.silentLogin=Na;this.options=db;this.correlationId=Ja}function t(){}function B(Ha){this.Jsg=Ha}function z(){}b.r(F);A=b(0);var u=b(13),C=b(815),
r=b(1051),J;(function(Ha){Ha[Ha.external=0]="external";Ha[Ha.msa=1]="msa";Ha[Ha.aad=2]="aad"})(J||(J={}));Object(A.b)("AuthorityType",J);Object(A.a)(z,"OAuthResult",null,[]);B.prototype.initialize=function(){return Promise.resolve(0)};B.prototype.Bjc=function(){return Promise.resolve(0)};B.prototype.FS=function(){u.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new z,{IsSuccess:!0,Token:this.Jsg}))};B.prototype.AAc=function(){return Promise.resolve(Object.assign(new z,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};B.prototype.bzc=function(){return!1};B.prototype.Svb=function(){return"MockAuthTokenStrategy"};Object(A.a)(B,"MockAuthTokenStrategy",null,[870]);var v=b(1078);t.get=function(Ha,Xa,Na){if(!Na)return Ha;var db=0;return Promise.race([Ha,new Promise(function(Ja){db=window.setTimeout(function(){Ja(Xa)},Na)})]).then(function(Ja){window.clearTimeout(db);
return Promise.resolve(Ja)}).catch(function(){window.clearTimeout(db);return Promise.resolve(Xa)})};Object(A.a)(t,"PromiseWithTimeout",null,[]);var D=b(5),V=b(857);Object(A.a)(y,"TokenRequestParameters",null,[481]);var U=b(23),Q=b(86);x.prototype.initialize=function(){var Ha=this;return new Promise(function(Xa){Q.a.instance.oc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Na){Ha.ake=Na;Xa(0)})})};x.prototype.Bi=function(Ha){for(var Xa=!1,Na=Ha.toLocaleUpperCase(),db=yl(["HTTPS:","API:"]),
Ja=db.next();!Ja.done;Ja=db.next())if(Na.startsWith(Ja.value)){Xa=!0;break}return Xa||this.sji(Ha)?Ha+"/.default":Ha};x.prototype.sji=function(Ha){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(Ha)};x.prototype.Bjc=function(){return Promise.resolve(0)};x.prototype.FS=function(Ha,Xa,Na,db,Ja,jb,hc){if(U.a.ala){Ja=V.a.OXj;if(!Ja)return Xa=Object.assign(new z,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(Xa);
if(!Array.contains(Ja,Ha))return Xa=Object.assign(new z,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+Ha}),Promise.resolve(Xa)}Ha=this.Bi(Na);Na=new y(Na,Ha,!db,null,D.AFrameworkApplication.userSessionId);return this.ake.getAccessToken(Na,Xa,hc).then(function(ma){return Object.assign(new z,{IsSuccess:!0,Token:ma.accessToken})},function(ma){return Object.assign(new z,{IsSuccess:!1,ErrorCode:ma})})};x.prototype.AAc=function(){return Promise.resolve(Object.assign(new z,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};x.prototype.bzc=function(){return!1};x.prototype.Svb=function(){return this.HXa};Object(A.a)(x,"ParentFrameTokenStrategy",null,[870]);var la=b(80),ba=b(988),T=b(184);Object(A.a)(f,"PromiseWrapper",null,[]);m.prototype.enqueue=function(Ha){var Xa=this;return new Promise(function(Na,db){Xa.wm.add(Object.assign(new f,{KKf:Ha,resolve:Na,reject:db}));
Xa.process()})};m.prototype.process=function(){var Ha=this;if(this.Fkb||this.IB===this.wm.count)return!1;var Xa=this.wm.oa(this.IB++);try{this.Fkb=!0,Xa.KKf().then(function(Na){Ha.Fkb=!1;Ha.f2c(Xa,Na,null,!0)}).catch(function(Na){Ha.Fkb=!1;Ha.f2c(Xa,null,Na,!1)})}catch(Na){this.Fkb=!1,this.f2c(Xa,null,Na,!1)}return!0};m.prototype.f2c=function(Ha,Xa,Na,db){var Ja=this;db?0<this._timeout?window.setTimeout(function(){Ha.resolve(Xa);Ja.process()},this._timeout):(Ha.resolve(Xa),Ja.process()):0<this._timeout?
window.setTimeout(function(){Ha.reject(Na);Ja.process()},this._timeout):(Ha.reject(Na),Ja.process())};Object(A.a)(m,"PromiseQueue",null,[]);Object(A.a)(n,"ResolveWithCorrelation",null,[]);var H=b(84),S=b(140),K=b(961),da=b(170),fa=S.a;vm(l,fa);l.prototype.qxc=function(){var Ha={};Ha=(Ha.promptMessage=this.pug,Ha.errorText=CommonUIStrings.l_InternalError,Ha.rtl=D.AFrameworkApplication.isRtl,Ha.frameLoaded=!1,Ha.createFrame=Object(la.a)(this,this.L6g,"createFrame"),Ha.resolveDialogStyles=this.l5d,Ha);
var Xa={};this.B1=(Xa.id="SharedAuthConsentDialog",Xa.bodyControls=Ha,Xa);this.jc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(la.a)(this,this.Bwj,"sharedAuthConsentDialogHandler"),this.B1)};l.prototype.qeg=function(Ha,Xa){var Na=!0;Na=void 0===Na?!1:Na;Ha=void 0===Ha?!1:Ha;Xa=void 0===Xa?5:Xa;this.B1&&this.B1.bodyControls&&(Na!==Object(H.a)(Object,this.B1.bodyControls).frameLoaded&&(Object(H.a)(Object,this.B1.bodyControls).frameLoaded=Na),Ha!==Object(H.a)(Object,this.B1.bodyControls).frameLoadSuccess&&
(Object(H.a)(Object,this.B1.bodyControls).frameLoadSuccess=Ha),Xa!==this.B1.dialogButtonsOption&&(this.B1.dialogButtonsOption=null,this.jc=Xa),this.update(this.B1))};l.prototype.TCj=function(Ha,Xa){var Na=new K.a(da.a.Fwj),db={};Ha=(db.signInLabel=CommonUIStrings.l_SignIn,db.cancelLabel=CommonUIStrings.l_DialogCancel,db.rtl=D.AFrameworkApplication.isRtl,db.messageCorrelationId=Ha,db.dialogStyles=Xa,db);Na.Values=Ha;this.zv.pRa(Na,this.Hs.contentWindow,this.kY)};l.prototype.KVe=function(){this.qeg(!1,
6)};l.prototype.bTi=function(){this.KVe()};l.prototype.L6g=function(){return this.Hs};l.prototype.Bwj=function(Ha){0===Ha&&(this.jyg.reject(Object.assign(new z,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.HDa(null))};Sk.Object.defineProperties(l.prototype,{D1f:{configurable:!0,enumerable:!0,get:function(){return this.Hs}},afh:{configurable:!0,enumerable:!0,get:function(){var Ha=this;return this.Sng.then(function(Xa){Ha.m5d=!0;return Xa})}},bfh:{configurable:!0,
enumerable:!0,get:function(){return this.m5d}}});Object(A.a)(l,"SharedAuthConsentDialog",S.a,[886]);var X=b(1247),ca=b(95),ja=b(129),ea=b(47),qa=b(178),pa=b(338);e.prototype.Svb=function(){return this.HXa};e.prototype.initialize=function(){var Ha=b(981).OAuthManager;if("loadFrame"in this.Yqa)return this.Yqa.loadFrame.Nte;if(!this.kY)return ca.Health.instance.recordKpiFailure(Ha.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),u.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),
Promise.reject(1);Ha=this.Kyc("loadFrame");this.uSb=ea.a.we();var Xa=this.kY+this.$ge+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+D.AFrameworkApplication.userSessionId+"&WacUserType="+D.AFrameworkApplication.userType;this.eXb&&(Xa+="&vnext=1");this.Hs=document.createElement("iframe");this.Vai(this.Hs);this.Hs.style.cssText="height:0;width:0;display:none;";this.Hs.id="SharedAuthFrame";this.Hs.setAttribute("name","SharedAuthFrame");this.Hs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.Hs.setAttribute("title","SharedAuthFrame");this.Hs.src=Xa;document.body.appendChild(this.Hs);Xa=ea.a.we()-this.uSb;u.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",Xa,this.Hs.src);return Ha};e.prototype.Bjc=function(Ha){this.cFc=Ha;var Xa=new K.a(da.a.G1f);Xa.Values=this.nte(Ha);Ha=this.Kyc("initFrame");this.zv.pRa(Xa,this.Hs.contentWindow,this.kY);u.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return Ha};e.prototype.FS=function(Ha,Xa,Na,db,Ja,jb){var hc=this,ma=new K.a(da.a.Gwj),Ka=this.T2e();ma.Values=this.Zag(Ha,Xa,Na,db,Ja,jb,Ka);Ha=this.Kyc(Ka);db&&D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.Mqg.enqueue(function(){return new Promise(function(Ta){hc.yOj(jb,ma,Ta,Ka)})}):(this.zv.pRa(ma,this.Hs.contentWindow,this.kY),u.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",
Xa));return Ha};e.prototype.yOj=function(Ha,Xa,Na,db){var Ja=this.Yqa[db];Ja&&(this.UXa=Xa,this.HDa=Object.assign(new n,{resolve:Na,correlationId:db}),this.kM=new l(this.kY,this.$ge,Ha,this.zv,Ja,Na,this.eXb),this.kM.qxc())};e.prototype.T2e=function(){return qa.a.create().toString()};e.prototype.Zag=function(Ha,Xa,Na,db,Ja,jb,hc){var ma={};ma.appName=Ha;ma.appId=Xa;ma.target=Na;ma.withPopup=db;ma.claims=Ja;ma.promptMessage=jb;ma.messageCorrelationId=hc;return ma};e.prototype.Vai=function(Ha){$addHandler(Ha,
"load",Object(la.a)(this,this.WNi,"onIFrameLoaded"));$addHandler(Ha,"error",Object(la.a)(this,this.jnc,"onIFrameError"));this.zv.vFa(this.kY);this.zv.Zn(da.a.J1f);this.zv.Kl(da.a.J1f,Object(la.a)(this,this.vSi,"onScriptLoaded"));this.zv.Zn(da.a.I1f);this.zv.Kl(da.a.I1f,Object(la.a)(this,this.uSi,"onScriptInitialized"));this.zv.Zn(da.a.E1f);this.zv.Kl(da.a.E1f,Object(la.a)(this,this.zNi,"onGetTokenResponse"));this.zv.Zn(da.a.K1f);this.zv.Kl(da.a.K1f,Object(la.a)(this,this.rPi,"onLoginResponse"));this.zv.Zn(da.a.H1f);
this.zv.Kl(da.a.H1f,Object(la.a)(this,this.rOi,"onInteractiveFlowReady"));this.zv.Zn(da.a.F1f);this.zv.Kl(da.a.F1f,Object(la.a)(this,this.PNi,"onHideDialog"));this.zv.Zn(da.a.C1f);this.zv.Kl(da.a.C1f,Object(la.a)(this,this.VIi,"onCloseDialog"))};e.prototype.Kyc=function(Ha){var Xa=new f;Xa.startTime=ea.a.we();var Na=new Promise(function(db,Ja){Xa.resolve=db;Xa.reject=Ja});Xa.Nte=Na;this.Yqa[Ha]=Xa;return Na};e.prototype.WNi=function(){var Ha=ea.a.we()-this.uSb;u.ULS.sendTraceTag(572346566,3E3,50,
"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",Ha)};e.prototype.jnc=function(Ha){var Xa=b(981).OAuthManager,Na=ea.a.we()-this.uSb,db=Object.assign(new pa.a,{durationMs:Na});ca.Health.instance.recordKpiFailure(Xa.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,db);u.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Na,this.X5d?JSON.stringify(Ha):"")};e.prototype.vSi=function(Ha){var Xa=b(981).OAuthManager,Na=this.Yqa.loadFrame,db=ea.a.we()-Na.startTime,
Ja=Ha.Values.AuthLibrary.toString();Ha=Ha.Values.Success.toString();u.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",Ha,Ja,db);Ja&&(this.HXa="SharedAuthTokenStrategy "+Ja);Ja=Boolean.parse(Ha);Ja||(Ha=ja.a.Wr(),void 0!==Ha&&null!==Ha&&(Ha.set("AuthLibrary",this.Svb()),db=Object.assign(new pa.a,{durationMs:db,extendedProperties:Ha}),ca.Health.instance.recordKpiFailure(Xa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,db)));Na.resolve(Ja?
0:1)};e.prototype.uSi=function(Ha){var Xa=this;if(Ha.Values.interactive&&this.UXa&&this.UXa.Values.messageCorrelationId){var Na=this.UXa.Values.messageCorrelationId.toString();if(Ha.Values.interactive&&this.kM){this.kM.afh.then(function(Ja){Xa.zv.pRa(Xa.UXa,Xa.kM.D1f.contentWindow,Xa.kY);Xa.kM.TCj(Na,Ja);Xa.kM.qeg(!0);Xa.UXa=null});return}}Ha=this.Yqa.initFrame;var db=ea.a.we()-Ha.startTime;u.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",db);Ha.resolve(0)};
e.prototype.zNi=function(Ha){if(Ha.Values.messageCorrelationId&&Ha.Values.messageCorrelationId.toString()){var Xa=Ha.Values.messageCorrelationId.toString(),Na=this.Yqa[Xa];if(Na){var db=ea.a.we()-Na.startTime;u.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",db);Ha.Values.isSuccess&&Ha.Values.isSuccess?Na.resolve(Ha.Values.response):Na.reject(Ha.Values.response);this.nbg(Xa)}else u.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else u.ULS.sendTraceTag(573112904,
3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};e.prototype.rOi=function(){if(this.kM.bfh)this.kM.KVe();else if(this.cFc&&this.kM){var Ha=new K.a(da.a.G1f);Ha.Values=this.nte(this.cFc,!0);this.zv.pRa(Ha,this.kM.D1f.contentWindow,this.kY)}};e.prototype.PNi=function(){this.kM&&this.kM.cxb()};e.prototype.VIi=function(Ha){Ha.Values.cancelled&&Ha.Values.cancelled&&Ha.Values.messageCorrelationId&&this.nbg(Ha.Values.messageCorrelationId.toString());this.kM&&
this.kM.hide()};e.prototype.nte=function(Ha,Xa){Xa=void 0===Xa?!1:Xa;var Na={};Na.appIds=this.hKh();Na.upn=Ha.loginHint;Na.authority=Ha.authority;Na.authorityType=Object(C.a)(J,Ha.authorityType);Na.tenantId=Ha.tenantId;Na.correlationId=D.AFrameworkApplication.userSessionId;Na.enableConsoleLogging=this.X5d;Na.enablePopupFlash=this.mog;Na.skipUpnCheck=this.Iwg;Na.interactive=Xa;return Na};e.prototype.hKh=function(){var Ha=[],Xa=V.a.wWc,Na;for(Na in Xa)Array.add(Ha,Xa[Na]);return Ha};e.prototype.AAc=
function(Ha,Xa,Na,db,Ja,jb){var hc=new K.a(da.a.Ewj),ma=this.T2e();hc.Values=this.Zag(Ha,Xa,Na,db,Ja,jb,ma);this.aje=hc;Ha=this.Kyc(ma);u.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",Xa);this.wAj();return Ha};e.prototype.bzc=function(){return!0};e.prototype.wAj=function(){var Ha=this;this.Mjb||(this.Mjb=new ba.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Mjb.id=16,this.Mjb.$ff=!1,
this.Mjb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){u.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");Ha.zv.pRa(Ha.aje,Ha.Hs.contentWindow,Ha.kY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),u.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};e.prototype.rPi=function(Ha){if(Ha.Values.messageCorrelationId&&Ha.Values.messageCorrelationId.toString()){var Xa=
this.Yqa[Ha.Values.messageCorrelationId.toString()];if(Xa){var Na=ea.a.we()-Xa.startTime;u.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Na);Ha.Values.isSuccess&&Ha.Values.isSuccess?Xa.resolve(Ha.Values.response):Xa.reject(Ha.Values.response)}else u.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else u.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};
e.prototype.nbg=function(Ha){this.HDa&&this.HDa.correlationId===Ha&&(this.HDa.resolve(null),this.HDa=null)};Object(A.a)(e,"SharedAuthTokenStrategy",null,[870]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.Bjc=function(){return Promise.resolve(0)};c.prototype.FS=function(){return Promise.resolve(Object.assign(new z,{IsSuccess:!1,ErrorCode:r.a[this.pPc],ErrorMessage:"Unable to get a token. Reason: ["+r.a[this.pPc]+"]"}))};c.prototype.AAc=function(){return Promise.resolve(Object.assign(new z,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};c.prototype.bzc=function(){return!1};c.prototype.Svb=function(){return this.HXa};Object(A.a)(c,"UnsupportedAuthTokenStrategy",null,[870]);var Pa=b(845);b.d(F,"OAuthManager",function(){return a});a.prototype.oeh=function(){var Ha=V.a.GBi;Ha&&0<Ha.length?(this.YS=1,this.oP=new B(Ha)):D.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||D.AFrameworkApplication.ga.ra("IsO365CommercialHost")?
D.AFrameworkApplication.ga.ra("IsAnonymousUser")?(this.YS=2,this.oP=new c(this.YS)):(Ha=v.a.getAuthContext().loginHint)&&Ha.length?V.a.hxb?(this.YS=1,this.oP=new x):(this.YS=1,this.oP=new e):(this.YS=3,this.oP=new c(this.YS)):(this.YS=4,this.oP=new c(this.YS))};a.prototype.Qu=function(){return this.oP?this.oP.Svb()||"Unknown":"None"};a.prototype.neh=function(Ha){var Xa=this;Ha=void 0===Ha?null:Ha;u.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Na=ea.a.we();return D.AFrameworkApplication.ga.afd().then(function(db){db?
(Xa.oeh(),Ha&&(Xa.oP=Ha),u.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",V.a.clientVersion,V.a.appVersion,V.a.uhh,Xa.Qu(),Math.floor(ea.a.we()-Na))):u.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ea.a.we()-Na));return Promise.resolve(db)},function(){u.ULS.sendTraceTag(562128580,3E3,
15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ea.a.we()-Na));return Promise.resolve(!1)})};a.prototype.p$h=function(){var Ha=this;u.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.Qu());var Xa=ea.a.we();return t.get(this.oP.initialize(),2,V.a.JFd).then(function(Na){if(0===Na)u.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",Ha.Qu(),Math.floor(ea.a.we()-Xa));else if(1===
Na){u.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",Ha.Qu(),Math.floor(ea.a.we()-Xa));var db=ja.a.Wr();void 0!==db&&null!==db&&(db.set("AuthLibrary",Ha.Qu()),db=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.we()-Xa),extendedProperties:db}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,db))}else 2===Na&&(u.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",
Ha.Qu(),Math.floor(ea.a.we()-Xa)),db=ja.a.Wr(),void 0!==db&&null!==db&&(db.set("AuthLibrary",Ha.Qu()),db=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.we()-Xa),extendedProperties:db}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,db)));return Promise.resolve(Na)},function(){u.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Qu(),Math.floor(ea.a.we()-Xa));return Promise.resolve(1)})};a.prototype.jti=
function(){var Ha=this;u.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Qu());var Xa=ea.a.we();return t.get(this.oP.Bjc(v.a.getAuthContext()),2,V.a.JFd).then(function(Na){if(0===Na)u.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",Ha.Qu(),Math.floor(ea.a.we()-Xa));else if(1===Na){u.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Qu(),Math.floor(ea.a.we()-Xa));var db=ja.a.Wr();void 0!==db&&null!==db&&(db.set("AuthLibrary",
Ha.Qu()),db=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.we()-Xa),extendedProperties:db}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,db))}else 2===Na&&(u.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Qu(),Math.floor(ea.a.we()-Xa)),db=ja.a.Wr(),void 0!==db&&null!==db&&(db.set("AuthLibrary",Ha.Qu()),db=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.we()-Xa),extendedProperties:db}),ca.Health.instance.recordKpiFailure(a.kpiName,
"StrategyLoadTimedOut",!1,!0,db)));return Promise.resolve(Na)},function(){u.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Qu(),Math.floor(ea.a.we()-Xa));return Promise.resolve(1)})};a.prototype.FS=function(Ha,Xa,Na){return this.yAc(Ha,Xa,!1,null,"",void 0===Na?null:Na)};a.prototype.$ag=function(Ha,Xa,Na,db,Ja){return this.yAc(Ha,Xa,!0,Na,db,void 0===Ja?null:Ja)};a.prototype.yAc=function(Ha,Xa,Na,db,Ja,jb,hc){hc=void 0===hc?0:hc;
hc+=1;u.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",Ha,this.aRa(Ha,Xa),this.Qu(),hc);var ma=ja.a.Wr();void 0!==ma&&null!==ma&&(ma.set("AuthLibrary",this.Qu()),ma.set("AppName",Ha),ma.set("Target",this.aRa(Ha,Xa)),ca.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",ma));if(!V.a.isEnabled){var Ka;return this.gud((Ka=new z,Ka.IsSuccess=!1,Ka.Token=null,Ka.ErrorCode="NotEnabled",Ka.ErrorMessage="OAuthManager is disabled.",
Ka),Ha)}var Ta=V.a.wWc[Ha];if(void 0===Ta||null===Ta){u.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",Ha);var ob;return this.gud((ob=new z,ob.IsSuccess=!1,ob.Token=null,ob.ErrorCode="DisallowedApp",ob.ErrorMessage="Disallowed appName: "+Ha,ob),Ha)}var Cb=ea.a.we(),eb=this;ma=this.Bqg.then(function(cb){return eb.$ei(Ha,Ta,Xa,Na,db,Ja,jb,cb)});Ka=Na?0:V.a.JFd;var ya;ob=(ya=new z,ya.IsSuccess=!1,ya.Token=null,
ya.ErrorCode="authTokenStrategy_timeout",ya.ErrorMessage="Auth Strategy timed out after ["+Ka+"] ms when fetching token",ya);var za=this,Ga=this;return t.get(ma,ob,Ka).then(function(cb){return hc<=a.$zi&&(cb.ErrorCode===a.h$f||cb.ErrorCode===a.wHj)?(u.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",hc,Math.floor(ea.a.we()-Cb)),za.yAc(Ha,Xa,Na,db,Ja,jb,hc)):cb.ErrorCode===a.qjf&&!Na&&(u.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
hc,a.ALe),a.Ukh&&za.oP.bzc()&&za.oP.AAc(Ha,Ta,Xa,Na,db,Ja).then(function(Mb){return Promise.resolve(za.Vjc(Mb,Ha,Xa,Ta,Cb))}).catch(function(){var Mb,Dc=(Mb=new z,Mb.IsSuccess=!1,Mb.Token=null,Mb.ErrorCode="authTokenStrategy_failure",Mb.ErrorMessage="LoginPopup failed, GetToken could not be called",Mb);return Promise.resolve(za.Vjc(Dc,Ha,Xa,Ta,Cb))}),a.ALe)?za.yAc(Ha,Xa,!0,db,Ja,jb,hc):Promise.resolve(za.Vjc(cb,Ha,Xa,Ta,Cb))}).catch(function(){var cb,Mb=(cb=new z,cb.IsSuccess=!1,cb.Token=null,cb.ErrorCode=
"authTokenStrategy_failure",cb.ErrorMessage="Auth Strategy failed with an unknown error",cb);return Promise.resolve(Ga.Vjc(Mb,Ha,Xa,Ta,Cb))})};a.prototype.$ei=function(Ha,Xa,Na,db,Ja,jb,hc,ma){var Ka=this;return 1===ma||2===ma?this.gud(Object.assign(new z,{IsSuccess:!1,Token:null,ErrorCode:1===ma?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),Ha):this.oP.FS(Ha,Xa,Na,db,Ja,jb,hc).then(function(Ta){return Promise.resolve(Ka.Osf(Ta,!0,Ha))}).catch(function(Ta){return Promise.resolve(Ka.Osf(Ta,
!1,Ha))})};a.prototype.Vjc=function(Ha,Xa,Na,db,Ja){var jb={};Ja=ea.a.we()-Ja;jb.IsSuccess=Ha.IsSuccess;jb.ErrorCode=Ha.IsSuccess?"Success":Ha.ErrorCode||"";jb.ErrorMessage=Ha.IsSuccess?"Success":this.aRa(Xa,Ha.ErrorMessage||"");jb.Target=this.aRa(Xa,Na||"");jb.TimeInMS=Math.floor(Ja);jb.AuthLibrary=this.Qu();jb.AppName=Xa;jb.AuthorityType=Object(C.a)(J,v.a.S$b());jb.UserType=this.S0h(v.a.getAuthContext());jb.IsAuthSupportedInSession=r.a[this.YS];jb.RequestCount=++this.Yug;jb.AppId=db;u.ULS.sendTraceTag(593863640,
3E3,50,JSON.stringify(jb));Ha.IsSuccess||(Na=ja.a.Wr(),void 0!==Na&&null!==Na&&(Na.set("AppName",Xa),Na.set("AuthLibrary",this.Qu()),Na.set("ErrorCode",Ha.ErrorCode),Na.set("ErrorMessage",this.aRa(Xa,Ha.ErrorMessage)),Xa=Object.assign(new pa.a,{durationMs:Ja,extendedProperties:Na}),ca.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,Xa)));return Ha};a.prototype.gud=function(Ha,Xa){u.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",
Xa,this.aRa(Xa,Ha.ErrorMessage));var Na=ja.a.Wr();void 0!==Na&&null!==Na&&(Na.set("AppName",Xa),Na.set("AuthLibrary",this.Qu()),Na.set("ErrorCode",Ha.ErrorCode),Na.set("ErrorMessage",this.aRa(Xa,Ha.ErrorMessage)),Xa=Object.assign(new pa.a,{extendedProperties:Na}),ca.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,Xa));return Promise.resolve(Ha)};a.prototype.Hef=function(Ha){return Ha===Pa.a.Ozc};a.prototype.aRa=function(Ha,Xa){return this.Hef(Ha)&&Xa?"REDACTED":Xa};a.prototype.S0h=
function(Ha){return D.AFrameworkApplication.ga.ra("IsAnonymousUser")?"anonymous":!Ha.loginHint||1>Ha.loginHint.length?"empty":-1<Ha.loginHint.indexOf("guest#")?"guest":-1<Ha.loginHint.indexOf("ext#")?"external":0>Ha.upn.indexOf("@")?"no-at":"supported"};a.prototype.TLa=function(){return 1===this.YS};a.prototype.Osf=function(Ha,Xa,Na){var db=null,Ja=null,jb=null,hc=null;Ha?Ha.ErrorCode||Ha.ErrorMessage?(Ja=Ha.ErrorCode?Ha.ErrorCode:a.VRe,jb=Ha.ErrorMessage?Ha.ErrorMessage:"No message"):Ha.Token?Xa?
db=Ha.Token:(Ja=a.O$i,jb="A rejected promise returned a token."):(Ja=a.VRe,jb=JSON.stringify(Ha)):(Ja=a.eEi,jb="No result came from Auth Token Strategy");Ha&&Ha.Telemetry&&!this.Hef(Na)&&(hc=Ha.Telemetry,u.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(hc)));if(Ja===a.SBi||Ja===a.bMj)Ja=a.h$f,jb="Auth Library Timed Out";Ja===a.UMg&&-1<jb.indexOf(a.Zyg)&&(Ja=a.qjf);if(Ja||jb)db=null;return Object.assign(new z,{IsSuccess:!!db,Token:db,ErrorCode:Ja,ErrorMessage:jb,Telemetry:hc})};Sk.Object.defineProperties(a,
{ALe:{configurable:!0,enumerable:!0,get:function(){return D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},Ukh:{configurable:!0,enumerable:!0,get:function(){return D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.bMj="token_renewal_error";a.VRe="Exception";a.eEi="NoResult";a.O$i="RejectToken";a.SBi="monitor_window_timeout";a.h$f="Timeout";a.wHj="authTokenStrategy_timeout";
a.UMg="login_required";a.Zyg="AADSTS50058";a.qjf="Cookies Disabled";a.kpiName="OAuthManager";a.$zi=2;Object(A.a)(a,"OAuthManager",null,[825])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/8311a799440974843fa41453b9f81329/EwaDS.oauth.js.map