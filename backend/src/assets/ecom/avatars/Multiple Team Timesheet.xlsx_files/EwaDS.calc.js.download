(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[14],{1067:function(A,F,b){function a(C){var r=this;this.$=C;(this.Dl=this.$.da.Aa(268))||e.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var J=t.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?y.a.current.ro(53):y.a.current.ro(56);this.logger=new x.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.Xba=new c(C,this.Dl);excelOnlineCalc.config.initCalc(this.logger,this.Dl?function(v){return r.Dl.isFeatureEnabled(v)}:function(){return!1},J);this.Xmg=excelOnlineCalc.config.calcConfig(this.Xba.localeInfo)}function c(C,r){C=b(1067).CalcHelper;r&&(r.Je||e.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.jsg=C.xEe(r,C.kEe(r.sja));this.ksg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(F);A=b(0);var e=b(13),l=b(309),n;(function(C){C[C.paren=
0]="paren";C[C.lead=1]="lead";C[C.intern=2]="intern";C[C.trail=3]="trail";C[C.undefined=4]="undefined"})(n||(n={}));Object(A.b)("CurrencyFormatOption",n);var m;(function(C){C[C.none=-1]="none";C[C.mdy=0]="mdy";C[C.dmy=1]="dmy";C[C.ymd=2]="ymd";C[C.myd=3]="myd";C[C.dym=4]="dym";C[C.ydm=5]="ydm"})(m||(m={}));Object(A.b)("DateOrderOption",m);var f=b(8);c.prototype.formatNumber=function(C){return this.localeInfo.formatNumber(C)};Sk.Object.defineProperties(c.prototype,{localeInfo:{configurable:!0,enumerable:!0,
get:function(){return this.ksg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.jsg}}});Object(A.a)(c,"LocaleHolder",null,[]);var x=b(1127),y=b(53),t=b(1),B=b(19),z=b(14),u=b(192);b.d(F,"CalcHelper",function(){return a});a.prototype.Pah=function(){if(t.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return e.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var C=this.$.xa.pa;return C?
C.index:(e.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.pa.index};a.prototype.createParser=function(){var C={};C.config=this.config;return excelOnlineCalc.parse.createParser(C)};a.prototype.createNumberFormatter=function(){var C=this,r=t.EwaSettings.isChangeGateEnabled("OfficeVSO:5935278_numberFormatterGetTime")?function(J,v){return excelOnlineCalc.calc.getTime(C.config,J,v,"Estimation")}:function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))};
r=excelOnlineCalc.numfmt.createFormatGlobals(this.config,r);return excelOnlineCalc.numfmt.createNumberFormatter(r)};a.prototype.$9g=function(C,r,J){r=excelOnlineCalc.location.gridCell(r,J);C=excelOnlineCalc.location.sheetIndex(this.documentLoc,C);return excelOnlineCalc.location.sheetGridCell(C,r)};a.prototype.Imh=function(C,r){var J=excelOnlineCalc.calc.getEvalResultKind(C);switch(J){case 4:return{returnValue:C?this.Xba.localeInfo.trueName:this.Xba.localeInfo.falseName,kind:J};case 1:return{returnValue:t.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.qAc(this.Xba.formatNumber(C),r):this.Xba.formatNumber(C),kind:J};case 2:return{returnValue:t.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.qAc(C.toString(),r):C.toString(),kind:J};case 128:return{returnValue:"",kind:J};case 8:switch(C.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.Xba.localeInfo.errorNames[C.type],kind:J};default:return{returnValue:a.unknownError,kind:J}}case 32:return{returnValue:t.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.qAc(this.r$g(C,r),r):"##UNSUPPORTED: ARRAY",kind:J};default:return{returnValue:z.a.instance.fa(2153),kind:J}}};a.prototype.qAc=function(C,r){return C.length<=r?C:C.substring(0,r-3)+"..."};a.prototype.r$g=function(C,r){for(var J=this.Xba.localeInfo.leftBrace,v=0;v<C.rows;++v){for(var D=0;D<C.cols;++D)J+=C.opers[v][D],D<C.cols-1&&(J+=this.Xba.localeInfo.columnSeparator);v<C.rows-1&&(J+=this.Xba.localeInfo.rowSeparator)}return this.qAc(J,r-1)+this.Xba.localeInfo.rightBrace};a.xEe=function(C,r){r=
void 0===r?null:r;var J=a.c4b(),v=C.Je.TrueValueString,D=C.Je.FalseValueString,V=C.Je.DecimalSeparator.toString(),U=C.Je.ListSeparator.toString(),Q=C.Je.ColumnSeparator.toString(),la=C.Je.RowSeparator.toString(),ba=C.Je.ThousandsDataArray,T=C.Je.ThousandSeparator.toString(),H=C.Je.Lcid,S=C.Je.Country,K=C.Je.DigitsNumber,da=C.Je.ExpSeparatedBySpace,fa=C.Je.FractionSeparator.toString(),X=C.Je.PercentSeparatedBySpace,ca=B.a.rVg(Enum.toString(n,C.Je.CurrencyFormat)),ja=C.Je.CurrencySymbolLead,ea=C.Je.CurrencySeparatedBySpace,
qa=C.Je.CurrencySymbolString,pa=C.Je.DigitsCurrency,Pa=-1===C.Je.DateOrder?"MDY":u.c(Enum.toString(m,C.Je.DateOrder)),Ha=C.Je.DateSeparator.toString(),Xa=C.Je.DateAlternativeSeparator.toString(),Na=C.Je.Year4Digits,db=C.Je.Month2Digits,Ja=C.Je.Day2Digits,jb=C.Je.LongDateFormat,hc=C.Je.TimeSeparator.toString(),ma=null==C.Je.TimeAltSeparator?null:C.Je.TimeAltSeparator.toString(),Ka=C.Je.Hour2Digits,Ta=C.Je.Use24HourClock,ob=C.Je.AmPmSeparatedBySpace,Cb=[C.Je.AmString,C.Je.PmString],eb=C.Je.DayNameShortArray,
ya=C.Je.DayNameLongArray,za=C.Je.MonthNameShortArray,Ga=C.Je.MonthNameLongArray,cb=C.Je.PictureSpecialArray,Mb=l.a.map(("\x00"+C.Je.PictureSingleString).split(""),function(mb){return"\x00"===mb?null:mb}),Dc=C.Je.PictureColorArray,vb=C.Je.PictureDbnumArray,ib=C.Je.RowLetter.toString(),ub=C.Je.ColumnLetter.toString(),Eb=C.Je.LeftBrace.toString(),Ya=C.Je.RightBrace.toString(),tb=C.Je.LeftBracket.toString(),ec=C.Je.RightBracket.toString(),Za=a.zZh(C.Je);return excelOnlineCalc.calc.localeData(r,J,v,D,
ib,ub,Eb,Ya,tb,ec,V,U,Q,la,ba,T,H,S,K,da,fa,X,ca,ja,ea,qa,pa,Pa,Ha,Xa,Na,db,Ja,jb,hc,ma,Ka,Ta,ob,Cb,eb,ya,za,Ga,cb,Mb,Dc,vb,Za,C.Je.SysDateFormatString,C.Je.SysTimeFormatString)};a.kEe=function(C){var r=[];if(!C)return r;C=yl(C);for(var J=C.next();!J.done;J=C.next()){J=J.value;var v=null;J.IsDynamicUdf||(v=excelOnlineCalc.calc.worksheetFunctionName(J.FunctionIndexInServer,J.NameUI));v&&Array.add(r,v)}return r};a.c4b=function(){for(var C=[],r=Object.keys(f.a.errorNames),J=0;J<r.length;J++){var v=excelOnlineCalc.calc.errorTypeName(J+
1,r[J]);v&&Array.add(C,v)}return C};a.zZh=function(C){var r=Array(6);r[1]="#"+C.AllStructRefString;r[3]="#"+C.HeadersStructRefString;r[2]="#"+C.DataStructRefString;r[4]="#"+C.TotalsStructRefString;r[5]="#"+C.ThisRowStructRefString;return r};Sk.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.Xmg}}});a.unknownError="##ERR##";Object(A.a)(a,"CalcHelper",null,[])},1129:function(A,F,b){function a(){}b.d(F,"a",function(){return a});A=b(0);a.eti="literal";
a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.olf="letName";a.all="*";a.$Td="structRefRange";Object(A.a)(a,"TraverseFormulaInterestTypes",null,[])},1130:function(A,F,b){function a(){}b.d(F,"a",function(){return a});A=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(A.a)(a,"TraverseFormulaRefTypes",null,[])},1392:function(A,F,b){function a(P){var Ba=Ob.call(this)||this;Ba.$=P;Ba.dc();return Ba}function c(P){var Ba=Jb.call(this)||this;Ba.$=P;
Ba.dc();return Ba}function e(P,Ba){var ra=this;this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");this.x5a=this.x8f=!1;this.$Cb=function(){ra.x5a=!1};this.Oc=P;this.gridView=db.g(P);this.calcManager=Ba;this.tki=Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.lif=Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5899330_SuspendResumeRichText");
this.Acf=Pa.EwaSettings.la(719);this.gridView.yc.Mo(this.$Cb)}function l(P,Ba,ra,ta){this.aKj=P;this.z9f=Ba;this.ohc=void 0===ta?!1:ta;ra?(this.L6a=ra.IsRangeRef,this.ywa=ra.IsAbsoluteFirstRow,this.xwa=ra.IsAbsoluteFirstColumn,this.LLa=ra.IsAbsoluteSecondRow,this.KLa=ra.IsAbsoluteSecondColumn):Q.ULS.shipAssertTag(537169941,0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function n(P){var Ba=Xb.call(this)||this;Ba.$=P;Ba.dc();return Ba}function m(P){var Ba=this;this.wl=null;this.Igg=!1;this.tLd=
this.instantaneousSupportInformationManager=this.ZEb=null;this.Itf={};this.Ktf={};this.uce=null;this.wnc=function(ra){Q.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");ra.yJd(Ba.wnc);ra.sja.length?Ba.anc(ra,Sys.EventArgs.Empty):(Q.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),ra.Qne(Ba.anc))};this.anc=function(ra){Q.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");ra.mJd(Ba.anc);
Ba.AOj(ra)};this.onContentReady=function(){Ba.wl&&(Ba.instantaneousSupportInformationManager&&Ba.instantaneousSupportInformationManager.xmd||mb.Task.delay(0).CWCT(function(){Ba.wl.Teb(1)},null,0,sc.a.current))};this.mvf=function(ra,ta){Ba.wl&&(Ba.instantaneousSupportInformationManager&&Ba.instantaneousSupportInformationManager.xmd||Ba.wl.EFe(ta.dd.block))};Q.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.Ucf=!1;this.vb=P;this.Dy=db.g(P);this.NFc=null;this.gridView.ar(this.onContentReady);
this.gridView.Ca.TUc(this.mvf);this.$.da.Za(268,function(ra){ra.Je?(Q.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),Ba.wnc(ra,Sys.EventArgs.Empty)):(Q.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),ra.koe(Ba.wnc))})}function f(){}function x(){}function y(){this.KLa=this.LLa=this.xwa=this.ywa=this.L6a=!1}function t(P){var Ba=this;this.aHd=null;this.Std=this.$Gd=this.$Db=!1;this.ZEd=0;this.QEd=this.SEd=this.TEd=this.REd=
-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Km=this.errorTypeNames=null;this.Zp=this.currentStateId=-1;this.sta="";this.R$=null;this.eBf=function(){Ba.setNumberFormats()};this.rd=function(){Q.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");Ba.Ye=new jb.a;Ba.Zp=-1;Ba.currentStateId=-1;Ba.sta="";Ba.urb=null;Ba.$Gd=!1;Ba.Km&&Ba.clearCache()};this.R5f=(this.Oc=P)?P.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.R5f;this.Ye=
new jb.a;this.urb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Oc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.woa()}function B(P){this.G3d=null;this.init(P)}function z(){}function u(P){this.Jna=P;this.b6=new Cb.a(eb.a.Hk());this.Dlc=!1}function C(){this.tj=[];this.Jcg=[];this.q_a={}}function r(P,Ba,ra,ta,Ia){this.type=P;this.fullName=Ba;this.range=ra;this.sheetId=ta;this.attributes=Ia;this.oE=null}function J(P,Ba){this.awe=P;this.sheetName=Ba;this.kvc=!1}function v(P){var Ba=
ma.call(this)||this;Ba.$=P;Ba.dc();return Ba}function D(P,Ba){var ra=hc.call(this)||this;ra.kNa=S.a.Te;ra.yZc=null;ra.Sic=!1;ra.yfb=!1;ra.tuf=function(){var ta=db.g(ra.$);ta&&(ta=ta.uc(null))&&ra.Geb(ta.cell.Em,!0)};ra.VLi=function(ta){ra.isActive()&&(pa.a.er(ta.Errors)||!ta.Result?Q.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",ta.Errors?ta.Errors.join(","):"None"):(ta=ta.Result,Q.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",
ta.Index,ta.Category),ra.Osj(ta.Index,ta.Category),ra.raiseEvent(D.A_c,new da.a(ta.Index,ta.Category),ra)))};ra.refresh=function(){Q.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");ra.k1b();if(ra.isActive()&&ra.ea.nc.allowEdits){if(ra.yfb||ra.mn&&!(ra.ea.MAb>ra.kNa))ra.NCc();else{Q.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");var ta=ra.$.na.ta;var Ia=ra.mn?ra.mn.Digest:
"",bb=ra.DMi,Va=ra.CMi,lb=ta.Na(1,null);lb.previousResponseDigest=Ia;ta=X.i(ta,"GetInstantaneousSupportInformation",lb,bb,Va,null,null,132);ra.Afd=ta}Q.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");ra.H_e()}};ra.Kyf=function(ta){Q.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",ta.data.status,ta.data.httpStatus);ra.mKa=null};ra.UN=function(){ra.yfb=
!1;ra.ea.VF(ra.UN);ra.eRa(ra.Sic?D.uQd:D.dyd)};ra.$c=function(ta,Ia){Q.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");fa.a(Ia)&&ra.eRa(D.uQd)};ra.Mf=function(){Q.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==ra.$.workbookContext.CalcMode&&ra.qyd(0===ra.$.workbookContext.CalcMode)};ra.rd=function(){Q.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");
ra.eRa(D.uQd);Pa.EwaSettings.la(306)&&3!==ra.$.workbookContext.CalcMode&&ra.qyd(0===ra.$.workbookContext.CalcMode)};ra.vMi=function(ta,Ia,bb){Q.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");ra.mKa=null;ra.isActive()?ta.StateId===S.a.Te?(Q.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),ra.NCc()):!ta.Result||ra.XX&&ra.XX.length?ra.eRa(D.dyd):ra.qCf(ta,Ia,
bb):Q.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};ra.qCf=function(ta){ra.XX=ta.Result;Q.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",ra.XX?ra.XX.length:-1);ta=!1;if(ra.XX){for(var Ia=yl(ra.XX),bb=Ia.next();!bb.done;bb=Ia.next())if(bb=bb.value)ra.pWe[bb.NameUI.toLocaleUpperCase()]=bb.FunctionIndex.toString(),
bb.NameUI!==bb.NameDataStrings&&(ra.pWe[bb.NameDataStrings.toLocaleUpperCase()]=bb.FunctionIndex.toString(),ta=!0),ra.HGh.ia(bb.FunctionIndex,bb.NameUI);ra.raiseEvent(D.Gcd,Sys.EventArgs.Empty,ra)}ta&&Q.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};ra.DMi=function(ta){if(ra.isActive())if(Q.ULS.shipAssertTag(537155679,0,!!ra.$,"null ewaControl"),ra.Sic=!1,ra.kNa=ta.StateId,ra.kNa===S.a.Te)ra.Sic=!0,ra.NCc();
else{if(ta.Result){var Ia=ra.mn;ra.mn=ta.Result;Q.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",ra.mn.Digest);ta=[];if(Ia)ta=D.YTh(Ia.NumberFormats,ra.mn.NumberFormats);else for(Ia=0;Ia<ra.mn.NumberFormats.length;Ia++)ra.cmc.ia(Ia,ra.mn.NumberFormats[Ia].NumberFormatCategory);Ia=yl(ta);for(var bb=Ia.next();!bb.done;bb=Ia.next())bb=bb.value,ra.cmc.ia(bb,ra.mn.NumberFormats[bb].NumberFormatCategory);ra.raiseEvent(D.Myd,new U(ta),ra);Pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",
!1)&&ra.raiseEvent(D.mmf)}ra.eRa(D.dyd)}};ra.CMi=function(ta){ra.isActive()&&(10===ta.data.status?Q.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(Q.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",ta.data.status,ta.data.httpStatus),ra.Sic=!0,ra.NCc()))};Q.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");ra.ea=P;ra.$=Ba;ra.BGb=null;ra.Afd=null;ra.mKa=null;
ra.mn=null;ra.cmc=new jb.a;ra.Cub=new jb.a;ra.XX=[];ra.HGh=new jb.a;ra.pWe={};ra.ea.Uj(ra.$c);ra.$.Qk(ra.rd);db.g(ra.$).ha.Ora(ra.tuf);Pa.EwaSettings.la(306)&&ra.ea.Dt(ra.Mf);ra.eRa(D.W$e);Q.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return ra}function V(P){this.data=P}function U(P){var Ba=ca.call(this)||this;Ba.u0j=P;return Ba}b.r(F);A=b(10);F=b(0);var Q=b(13),la=b(214),ba=b(88),T=b(5),H=b(184),S=b(8),K=b(36),da=b(1018),fa=b(217),X=b(81),ca=Sys.EventArgs;vm(U,
ca);Object(F.a)(U,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var ja=b(44),ea=b(42),qa=b(32),pa=b(27),Pa=b(1),Ha=b(659),Xa=b(19),Na=b(272),db=b(20),Ja=b(193);Object(F.a)(V,"NumberFormatDataHolder",null,[]);var jb=b(123),hc=K.a;vm(D,hc);D.prototype.koe=function(P){this.addHandler(D.Myd,P)};D.prototype.yJd=function(P){this.removeHandler(D.Myd,P)};D.prototype.iEg=function(P){this.addHandler(D.A_c,P)};D.prototype.Hbj=function(P){this.removeHandler(D.A_c,P)};D.prototype.Qne=function(P){this.addHandler(D.Gcd,
P)};D.prototype.mJd=function(P){this.removeHandler(D.Gcd,P)};D.prototype.NFg=function(P){this.addHandler(D.mmf,P)};D.prototype.Geb=function(P,Ba){var ra=this.cmc.Gc(P,0);var ta=ra.value;ra=ra.returnValue;!ra&&0<P&&this.$&&(Q.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",P),this.QLh(P),Ba&&(ta=this.PLh(P),ra=!0),Ha.a(P,this.$.RI)&&(ta=6));return{returnValue:ra,category:ta}};D.prototype.Xii=
function(P){var Ba=this.Geb(P,!0);var ra=Ba.category;if(Ba.returnValue)return 6===ra;Q.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",P);return!1};D.prototype.eFh=function(P){Q.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.mKa=X.x(this.$.na.ta,{FilterType:0},Na.b(this.qCf,P),this.Kyf,null,null,null)};D.prototype.JVe=
function(){this.eRa(D.W$e)};D.prototype.qyd=function(P){this.yZc=P};D.prototype.QLh=function(P){if(this.Cub&&this.$){var Ba=this.Cub.Gc(P);var ra=Ba.value;if(!Ba.returnValue||ra.isCompleted){Q.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",P);ra=this.$.na.ta;Ba=this.VLi;var ta=ra.Na(1,null);ta.ifmt=P;(ra=X.i(ra,"GetNumberFormatCategory",ta,Ba,null,null,null,4))&&this.Cub.ia(P,ra)}}else Q.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};
D.prototype.PLh=function(P){return 1<=P&&8>=P?1:9<=P&&12>=P?2:13===P||14===P?6:15===P?8:17===P|18===P?7:19===P?4:16===P||20<=P&&29>=P||31===P?11:30===P?9:32<=P&&35>=P?3:0};D.prototype.isActive=function(){var P=void 0===this.ea||null===this.ea,Ba=!P&&this.ea.qc;Q.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",Ba,P);return Ba};D.prototype.Osj=function(P,Ba){this.cmc.ia(P,
Ba)};D.prototype.dispose=function(){ba.a.Fa(this.BGb);this.BGb=null;this.k1b();for(var P=yl(this.Cub),Ba=P.next();!Ba.done;Ba=P.next())(Ba=Ba.value.value)&&!Ba.isCompleted&&T.AFrameworkApplication.Jd.ou(Ba.Ft);this.Cub=null;this.ea&&(this.ea.lk(this.$c),this.yfb&&this.ea.VF(this.UN),this.yfb=!1,this.ea.Ew(this.Mf));this.ea=null;this.$&&db.g(this.$)&&db.g(this.$).ha&&(db.g(this.$).ha.Lza(this.tuf),this.$.pl(this.rd));this.$=null;hc.prototype.dispose.call(this)};D.prototype.isFeatureEnabled=function(P){try{switch(P){case "LocaleLongDateFormat":return Pa.EwaSettings.la(197);
case "GetLocaleDayNames":return Pa.EwaSettings.la(198);case "CalculateTextWidthIgnoreLetterSpacing":return Pa.EwaSettings.la(287);case "OfficeVSO:3657744_CalcFixForDateFormat":return Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return Pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1);case "CalcNewFunctions":return Pa.EwaSettings.la(248);case "CalcContractChecks":return Pa.EwaSettings.la(249);case "CalcSupportDynamicArrays":return Pa.EwaSettings.la(250);case "CalcFormatCalculations":return Pa.EwaSettings.la(251);case "CalcFormulaCacheAPIChanges":return Pa.EwaSettings.la(252);case "CalcStrictFormulaChecking":return Pa.EwaSettings.la(253);case "CalcSupportRowReference":return Pa.EwaSettings.la(264);case "CalcParserUsesPledges":return Pa.EwaSettings.la(311);case "CalcWebWorker":return!0;
case "CalcWebWorkerTest":return Pa.EwaSettings.la(310);case "CalcLookupFunctions":return Pa.EwaSettings.la(312);case "CalcLogStopWatch":return Pa.EwaSettings.la(380);case "CalcPreventSpillingHack":return Pa.EwaSettings.la(254);case "CalcDynamicArrayOperators":return Pa.EwaSettings.la(103);case "CalcDotOperator":return Pa.EwaSettings.la(609);case "CalcLetFunction":return Pa.EwaSettings.la(730);default:return P.startsWith("OfficeVSO:")?Pa.EwaSettings.isChangeGateEnabled(P):!1}}catch(Ba){return Q.ULS.sendTraceTag(537155724,
0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",P,Ba.toString()),!1}};D.prototype.eRa=function(P){this.isActive()&&this.ea.nc.allowEdits?(ba.a.Fa(this.BGb),this.BGb=null,this.BGb=ja.a.instance.create(this.refresh,P,ea.a.Bdi)):Q.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",void 0!==this.ea&&null!==this.ea&&void 0!==
this.ea.nc&&null!==this.ea.nc?this.ea.nc.allowEdits:!1,void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode)};D.prototype.H_e=function(){Q.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.mKa?Q.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.XX&&this.XX.length||(this.mKa=X.x(this.$.na.ta,{FilterType:0},this.vMi,this.Kyf,null,null,null)):Q.ULS.sendTraceTag(537155717,
0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};D.prototype.NCc=function(){this.yfb||(this.yfb=!0,this.ea.LG(this.UN))};D.prototype.k1b=function(){this.ou(this.Afd);this.ou(this.mKa);this.mKa=this.Afd=null};D.prototype.ou=function(P){P&&!P.isCompleted&&this.$.na.ta.Feb(P.Ft)};D.YTh=function(P,Ba){if(!P||!P.length)return[];if(!Ba||!Ba.length){Ba=Array(P.length);for(var ra=0;ra<P.length;++ra)Ba[ra]=P[ra].IfmtIndex;return Ba}var ta=new jb.a;
P=yl(P);for(ra=P.next();!ra.done;ra=P.next())ra=ra.value,ta.ia(ra.IfmtIndex,new V(ra));P=new H.a;ra={};Ba=yl(Ba);for(var Ia=Ba.next();!Ia.done;ra={Xfb:ra.Xfb,dPb:ra.dPb},Ia=Ba.next())ra.Xfb=Ia.value,ra.dPb=void 0,function(bb){return function(){var Va=ta.Gc(bb.Xfb.IfmtIndex);bb.dPb=Va.value;return Va}}(ra)().returnValue&&ra.dPb.data.FormatString===ra.Xfb.FormatString||P.add(ra.Xfb.IfmtIndex);return P.toArray()};Sk.Object.defineProperties(D.prototype,{Je:{configurable:!0,enumerable:!0,get:function(){return this.mn?
this.mn.LocaleInformation:null}},mca:{configurable:!0,enumerable:!0,get:function(){return this.mn?this.mn.NumberFormats:[]}},sja:{configurable:!0,enumerable:!0,get:function(){this.XX&&this.XX.length||this.H_e();return this.XX}},xdi:{configurable:!0,enumerable:!0,get:function(){return this.mn&&void 0!==this.mn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.mn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.mn.InstantaneousCalcWebWorkerPrecisionSamplingRate:D.wch}},Adi:{configurable:!0,
enumerable:!0,get:function(){return this.mn&&void 0!==this.mn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.mn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.mn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:D.Ach}},zdi:{configurable:!0,enumerable:!0,get:function(){return this.mn&&void 0!==this.mn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.mn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.mn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
D.zch}},ydi:{configurable:!0,enumerable:!0,get:function(){return this.mn&&void 0!==this.mn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.mn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.mn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:D.ych}},Gbf:{configurable:!0,enumerable:!0,get:function(){return this.mn?this.mn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:D.xch}},xmd:{configurable:!0,enumerable:!0,get:function(){return null!==this.yZc?this.yZc:
this.mn?this.mn.InstantaneousCalcManualMode:!1}}});D.Myd="isim0";D.A_c="isim1";D.Gcd="isim2";D.mmf="isim3";D.W$e=100;D.uQd=1E3;D.dyd=3E5;D.wch=.001;D.Ach=.1;D.zch=.2;D.ych=.001;D.xch=50;Object(F.a)(D,"InstantaneousSupportInformationManager",K.a,[408,3]);var ma=la.a;vm(v,ma);v.prototype.create=function(){this.$&&(Q.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Fb(this.$.da.Aa(268)||new D(this.$.ea,this.$)))};v.ja=function(P){if(!P)throw Error.argumentNull("ewaControl");
P.da.Ha(246,new v(P))};Object(F.a)(v,"InstantaneousSupportInformationManagerFactory",la.a,[]);var Ka=b(80),Ta=b(109),ob=b(84);Object(F.a)(J,"CalcBlockInformation",null,[]);Object(F.a)(r,"CalcNamedObject",null,[]);Object(F.a)(C,"GridCache",null,[]);var Cb=b(805),eb=b(574);Object(F.a)(u,"SheetInformation",null,[]);var ya=b(1067),za;(function(P){P[P.initialization=0]="initialization";P[P.contentReady=1]="contentReady";P[P.cellEdit=2]="cellEdit"})(za||(za={}));Object(F.b)("UpdateDataTrigger",za);var Ga=
b(61);z.local="Local";z.pKj="Thread";Object(F.a)(z,"RecalcServiceCreateMode",null,[]);var cb=b(43),Mb=b(39),Dc=b(154);B.prototype.init=function(P){this.G3d=new jb.a;if(void 0!==P&&null!==P&&void 0!==P.HeadersList&&null!==P.HeadersList&&0<P.HeadersList.length){P=yl(P.HeadersList);for(var Ba=P.next();!Ba.done;Ba=P.next())Ba=Ba.value,this.x$.ia(Ba.Index,Ba.Name)}};Sk.Object.defineProperties(B.prototype,{x$:{configurable:!0,enumerable:!0,get:function(){return this.G3d}}});Object(F.a)(B,"ColHeadersListData",
null,[]);var vb=b(94);b(192);var ib=b(335);t.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.yJd(this.eBf);this.Oc&&this.Oc.pl(this.rd);this.close()};t.prototype.Teb=function(P){if(!this.Km)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Oc.da.Aa(268),!this.instantaneousSupportInformationManager))return Q.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),
!1;2!==P&&(this.currentStateId=this.Oc.ea.MAb,this.currentStateId===S.a.Te&&(this.currentStateId=this.Oc.ea.uf));if(1===P&&this.currentStateId<this.Zp)return Q.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.Zp),!1;this.Mqj();0!==P&&this.$Gd||(this.gvj(),this.jsj(),this.Usj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.koe(this.eBf),this.Oc.Qk(this.rd),this.$Gd=!0);this.D7i();
var Ba=!1;0===P&&(Ba=this.nbi());if(0!==P||Ba)this.ruj()?(this.Wuj(P),this.Vuj(),this.Zp=this.currentStateId,this.WXg()):Q.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==P&&this.resumeRecalc();return!0};t.prototype.evalFormula=function(P){if(!this.Km)return Q.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});P=this.Km.evalFormula(this.Oc.ea.uf,P,Ga.d(this.Oc.xa.pa));
this.resumeRecalc();return P};t.prototype.evalFormulaRange=function(P,Ba,ra){if(!this.Km)return Q.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);Q.ULS.shipAssertTag(537170193,0,Ba.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");ra=cb.j(ra);Ba=cb.o(Ba,this.Oc);Ba=excelOnlineCalc.calc.cellLocation(Ba.FirstRow,Ba.FirstColumn);ra=t.BU("EvalFormulaRange",Ga.d(this.Oc.xa.pa),ra.FirstRow,ra.FirstColumn,
ra.LastRow,ra.LastColumn);Q.ULS.sendTraceTag(537170190,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.Zp);P=this.Km.evalFormulaRange(this.Zp,P,Ba,ra,null);P.then(function(ta){if(excelOnlineCalc.util.isSuccess(ta)){var Ia=[];ta=yl(ta.value);for(var bb=ta.next();!bb.done;bb=ta.next())bb=bb.value,excelOnlineCalc.util.isSuccess(bb.value)||(bb=bb.value.reason.kind.toString(),Array.contains(Ia,bb)||Ia.push(bb));Q.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",
Ia.length?Sys.Serialization.JavaScriptSerializer.serialize(Ia):"None")}else Q.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",ta.reason.kind)}).catch(function(ta){Q.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(ta));return Promise.reject(ta)});this.resumeRecalc();return P};t.prototype.MTg=function(P,Ba,ra,ta){ta=void 0===
ta?null:ta;if(this.Km&&P){var Ia=Ga.d(this.Oc.xa.pa),bb=P.cell.rK-1,Va=P.cell.qK-1,lb=bb,kc=Va,zb=null;ta&&(zb=excelOnlineCalc.calc.cellLocation(bb,Va),bb=ta.top-1,Va=ta.left-1,lb=ta.bottom-1,kc=ta.right-1);if(P.cell.St)if(ta=P.cell.St.tYc,ta===S.a.Te)Q.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",P.cell.St.Xd);else if(ta<this.Zp)Q.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",
bb,Va,ta,this.Zp);else if(ta<this.currentStateId)Q.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",bb,Va,ta,this.currentStateId);else if(this.$Db||(this.Km.setOnRecalcResults(ra),this.$Db=!0),this.vcg()&&!this.Teb(2))Q.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{kc=t.BU("CalculateFormula.cell",Ia,bb,Va,lb,kc);ra=[];var Sb=db.g(this.Oc);lb=Sb.Kh;db.g(this.Oc).$a.aj&&
(lb=Sb.Sf(1).Kh,lb.yna(1,1),lb.yna(3,1));Sb=null;lb?Sb=t.BU("CalculateFormula.viewport",Ia,lb.top-1,lb.left-1,lb.bottom-1,lb.right-1):Q.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");Ba=excelOnlineCalc.calc.inferredRangeFormulaEdit(kc,Ba,zb,Sb);Array.add(ra,Ba);P=lb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ia,bb,Va,Xa.a.UZb(P.cell.text),
ta,lb.top-1,lb.left-1,lb.bottom-1,lb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ia,bb,Va,Xa.a.UZb(P.cell.text),ta,"","","","");Q.ULS.sendTraceTag(537170181,0,50,P);this.Km.editRangeFormulas(ta,ra);this.resumeRecalc()}else Q.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",P.cell.rK,P.cell.qK)}else Q.ULS.sendTraceTag(537170188,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",
!this.Km,!P)};t.prototype.KTg=function(P,Ba,ra,ta){ta=void 0===ta?null:ta;var Ia=Ga.d(this.Oc.xa.pa),bb=P.cell.rK-1,Va=P.cell.qK-1,lb=bb,kc=Va,zb=null;ta&&(zb=excelOnlineCalc.calc.cellLocation(bb,Va),bb=ta.top-1,Va=ta.left-1,lb=ta.bottom-1,kc=ta.right-1);ra=this.xZd(P,ra,"SetCell");0>ra||(kc=t.BU("CalculateFormula.cell",Ia,bb,Va,lb,kc),lb=[],ta=this.Whd(Ia),Ba=excelOnlineCalc.calc.inferredRangeFormulaEdit(kc,Ba,zb,ta),Array.add(lb,Ba),P=(Ba=this.Z4e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
Ia,bb,Va,Xa.a.UZb(P.cell.text),ra,Ba.top-1,Ba.left-1,Ba.bottom-1,Ba.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ia,bb,Va,Xa.a.UZb(P.cell.text),ra,"","","",""),Q.ULS.sendTraceTag(537170180,0,50,P),this.Km.editRangeFormulas(ra,lb),this.resumeRecalc())};t.prototype.Vsb=function(P,Ba,ra,ta){if(!this.Km)return Q.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),
Promise.reject("RecalcService is null");Q.ULS.shipAssertTag(537170178,0,ra.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var Ia=Ga.d(this.Oc.xa.pa),bb=this.Whd(Ia),Va=null;if(P){Va=[];P=yl(P);for(var lb=P.next();!lb.done;lb=P.next())if(lb=lb.value,lb.column!==ra.left){var kc=lb.row-1;var zb=lb.column-1;kc=t.BU("EvalFormulaRangeOnClone.cell",Ia,kc,zb,kc,zb);zb=lb.text;Array.add(Va,excelOnlineCalc.calc.rangeWrite(kc,excelOnlineCalc.calc.valueCellData(zb,zb,lb.Em,
null)))}}ra=excelOnlineCalc.calc.cellLocation(ra.top-1,ra.left-1);Ba=t.BU("EvalFormulaRangeOnClone.outputColumnRange",Ia,Ba.top-1,Ba.left-1,Ba.bottom-1,Ba.right-1);ta=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(Ba,ta,ra,bb)];Va=this.Km.evalOnClonedModel(Va,ta);this.resumeRecalc();return Va};t.prototype.EFe=function(P){var Ba=null;try{if(P)if(this.sta=db.g(this.Oc).Ca.bva(P),this.currentStateId=P.QSa,this.currentStateId<this.Zp||this.currentStateId===S.a.Te)Q.ULS.sendTraceTag(537170176,0,50,
"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.sta,this.currentStateId,this.Zp);else{if(this.sbi(),!this.LOg()){var ra=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",this.sta,this.currentStateId);Ba=this.Oc.Vb.Hc("ModelUpdate",ra);this.urb=this.Qvb(P.pa.sheetName);if(!this.urb){var ta=!!(this.Oc.Hd&32);Q.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",
this.Ye.xb(this.currentStateId)&&this.Ye.oa(this.currentStateId).tj?this.Ye.oa(this.currentStateId).tj.length:0,ta,P.pa.sheetName?P.pa.sheetName.length:-1,P.pa.hash)}else if(db.g(this.Oc).Ca.Ll.A1a(P.Xd)){var Ia=P.Cf;if(Ia){var bb=Ia.getCalcBlockModel();if(!bb)Q.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.DOg(bb)){this.Ye.oa(this.currentStateId).q_a[this.sta]=new J(bb,P.pa.sheetName);var Va=P.se;Va?this.UBg(Va.NamedObjects):
Q.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else Q.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",this.sta)}}}else Q.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{Ba&&Ba.stop()}};t.prototype.Wvb=function(P){if(!this.Ye.oa(this.currentStateId).tj||!this.Ye.oa(this.currentStateId).tj[0])return null;
var Ba=this.Ye.oa(this.currentStateId).tj[0].b6;if(!Ba||!Ba.xb(P.name))return null;Ba=Ba.oa(P.name);if(!Ba||!Ba.oE)return null;P=new H.a;Ba=yl(Ba.oE.x$);for(var ra=Ba.next();!ra.done;ra=Ba.next())P.add(ra.value.value);return P};t.prototype.getNameLoc=function(P,Ba){return this.Qgc()?this.Ye.oa(this.currentStateId).tj[0].b6.xb(Ba)?(P=excelOnlineCalc.location.nameLoc(P,Ba),excelOnlineCalc.util.success(P)):excelOnlineCalc.util.success(null):(P=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(P))};
t.prototype.getContainingTable=function(P){if(!this.Qgc())return P=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(P);var Ba=P.range.col,ra=P.range.row,ta=this.Ye.oa(this.currentStateId).tj[0].b6,Ia=null;ta=yl(ta);for(var bb=ta.next();!bb.done;bb=ta.next())if(bb=bb.value.value,2===bb.type&&Xa.a.equals(P.sheet.index.toString(),bb.sheetId,!0)){var Va=bb.range;Ba>=Va.left-1&&Ba<=Va.right-1&&ra<=Va.bottom-1&&ra>=Va.top-1&&(Ia=excelOnlineCalc.location.nameScope(this.documentLoc,bb.sheetId),
Ia=excelOnlineCalc.location.nameLoc(Ia,bb.fullName))}return Ia?excelOnlineCalc.util.success(Ia):excelOnlineCalc.util.success(null)};t.prototype.getStructRefColumn=function(P,Ba){if(!this.Qgc()){var ra=excelOnlineCalc.util.unavailable([2]);return excelOnlineCalc.util.failure(ra)}ra=P.name;var ta=this.Ye.oa(this.currentStateId).tj[0].b6;if(ta.xb(ra)){ta=ta.oa(ra);var Ia=ta.range;if(2!==ta.type)return excelOnlineCalc.util.failure(this.d4c(5));var bb=ta.oE?ta.oE.x$:null;if(!bb)return excelOnlineCalc.util.success(null);
for(var Va=yl(bb),lb=Va.next();!lb.done;lb=Va.next())if(lb=lb.value,Xa.a.equals(lb.value,Ba,!0))return P=excelOnlineCalc.location.documentLoc(P.scope.document.path,P.scope.document.name),P=excelOnlineCalc.location.sheetIndex(P,ta.sheetId),Ia=excelOnlineCalc.location.gridRange(Ia.top-1,lb.key,Ia.bottom-Ia.top+1,1),Ia=excelOnlineCalc.location.sheetGridRange(P,Ia),ra=excelOnlineCalc.location.structRefColumnLoc(ra,Ia,!!(ta.attributes&16),!!(ta.attributes&8)),excelOnlineCalc.util.success(ra);return Ia.right-
Ia.left+1!==bb.count?(ra=excelOnlineCalc.util.unavailable([17,P,Ba]),excelOnlineCalc.util.failure(ra)):excelOnlineCalc.util.failure(this.d4c(0))}return excelOnlineCalc.util.success(null)};t.prototype.getStructRefSpecialRef=function(P,Ba){if(!this.Qgc())return Ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Ba);var ra=this.Ye.oa(this.currentStateId).tj[0].b6;if(ra.xb(P.name)){var ta=ra.oa(P.name);if(2!==ta.type)return excelOnlineCalc.util.failure(this.d4c(5));ra=!!(ta.attributes&
16);var Ia=!!(ta.attributes&8),bb=ra?1:0,Va=Ia?1:0;P=excelOnlineCalc.location.documentLoc(P.scope.document.path,P.scope.document.name);P=excelOnlineCalc.location.sheetIndex(P,ta.sheetId);ta=ta.range;var lb={};if(1===Ba)lb=excelOnlineCalc.location.gridRange(ta.top-bb-1,ta.left-1,ta.bottom+Va-ta.top+bb+1,ta.right-ta.left+1);else if(2===Ba)lb=excelOnlineCalc.location.gridRange(ta.top-1,ta.left-1,ta.bottom-ta.top+1,ta.right-ta.left+1);else if(3===Ba)if(ra)lb=excelOnlineCalc.location.gridRange(ta.top-
2,ta.left-1,1,ta.right-ta.left+1);else return excelOnlineCalc.util.success(null);else if(4===Ba)if(Ia)lb=excelOnlineCalc.location.gridRange(ta.bottom,ta.left-1,1,ta.right-ta.left+1);else return excelOnlineCalc.util.success(null);Ba=excelOnlineCalc.location.sheetGridRange(P,lb);return excelOnlineCalc.util.success(Ba)}return excelOnlineCalc.util.success(null)};t.prototype.getDocumentLoc=function(P,Ba){if((Xa.a.equals(P,this.documentLoc.path,!0)||!P)&&Xa.a.equals(Ba,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);
P=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(P,Ba)]);return excelOnlineCalc.util.failure(P)};t.prototype.getSheetIndex=function(P,Ba){if(!this.Ye.xb(this.currentStateId)||!this.Ye.oa(this.currentStateId).tj)return Ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Ba);P=this.Ye.oa(this.currentStateId).tj;for(var ra=1;ra<P.length;ra++)if(Xa.a.equals(P[ra].Jna.sheetName,Ba,!0))return excelOnlineCalc.util.success(P[ra].Jna.sheetId);return excelOnlineCalc.util.success(null)};
t.prototype.getSheetName=function(P,Ba){if(!this.Ye.xb(this.currentStateId)||!this.Ye.oa(this.currentStateId).tj)return Ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Ba);P=this.Ye.oa(this.currentStateId).tj;for(var ra=1;ra<P.length;ra++)if(Xa.a.equals(P[ra].Jna.sheetId,Ba,!0))return excelOnlineCalc.util.success(P[ra].Jna.sheetName);return excelOnlineCalc.util.success(null)};t.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};
t.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};t.prototype.LTg=function(P,Ba,ra){var ta=db.g(this.Oc),Ia=ta.uc(Ba);Ia=this.xZd(Ia,null,"CopyPaste");ra=this.xZd(ta.uc(P),ra,"CopyPaste");if(0>Ia||0>ra||Ia!==ra)Q.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",ra,Ia);else{ra=[];ta=Ga.d(this.Oc.xa.pa);
var bb=this.Whd(ta);P=t.BU("CalculateFormulaForCopyPaste.srcRange",ta,P.top-1,P.left-1,P.bottom-1,P.right-1);Ba=t.BU("CalculateFormulaForCopyPaste.targetRange",ta,Ba.top-1,Ba.left-1,Ba.bottom-1,Ba.right-1);Ba=excelOnlineCalc.calc.copyPasteRangePasteEdit(Ba,P,bb);Array.add(ra,Ba);Ba=bb?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",ta,Ia,bb.row,bb.column,bb.lastRow,bb.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",
ta,Ia,"","","","");Q.ULS.sendTraceTag(537170142,0,50,Ba);this.Km.editRangePaste(Ia,ra);this.resumeRecalc()}};t.prototype.Whd=function(P){var Ba=this.Z4e(),ra=null;Ba?ra=t.BU("GetViewport.viewport",P,Ba.top-1,Ba.left-1,Ba.bottom-1,Ba.right-1):Q.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return ra};t.prototype.Z4e=function(){var P=db.g(this.Oc),Ba=P.Kh;if(db.g(this.Oc).$a.aj){Ba=P.Sf(1).Kh;if(Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&
!Ba)return Q.ULS.sendTraceTag(537170140,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;Ba.yna(1,1);Ba.yna(3,1)}return Ba};t.prototype.xZd=function(P,Ba,ra){if(!this.Km||!P)return Q.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Km,!P,ra),-1;var ta=P.cell.rK-1,Ia=P.cell.qK-1;if(P.cell.St){var bb=P.cell.St.tYc;if(bb===S.a.Te)return Q.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
P.cell.St.Xd,ra),-1}else return Q.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",P.cell.rK,P.cell.qK,ra),-1;if(bb<this.Zp)return Q.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",ta,Ia,bb,this.Zp,ra),-1;if(bb<this.currentStateId)return Q.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
ta,Ia,bb,this.currentStateId,ra),-1;Ba&&!this.$Db&&(this.Km.setOnRecalcResults(Ba),this.$Db=!0);return this.vcg()&&!this.Teb(2)?(Q.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",ra),-1):bb};t.prototype.getFormulaBarText=function(P,Ba,ra){return Ba&&Ba.startsWith("'")?Ba:P.cell.formulaBarText||ra.toString()};t.prototype.i9g=function(P,Ba,ra){var ta=null;if(this.Fwe()&&this.Ye.oa(this.Zp).q_a){var Ia=this.Ye.oa(this.Zp).q_a[P];if(null===
Ia||void 0===Ia?0:Ia.kvc)ta=Ia.awe}ra=this.agi(ta,Ba,ra);Ba=this.x0g(ta,Ba,ra);Q.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",P,this.currentStateId,Ba)};t.prototype.agi=function(P,Ba,ra){var ta=!1,Ia=t.nYe(Ba);if(P){var bb=t.nYe(P);Xa.a.equals(bb,Ia,!1)&&(ta=!0)}ta?this.wCg(P,this.Zp,ra):this.yCg(Ba,ra);return ta};t.prototype.Fwe=function(){var P=!1;this.Km&&-1!==this.Zp&&(P=this.Km.stateIdAvailable(this.Zp));
return P&&this.Ye.xb(this.Zp)&&this.Zp<this.currentStateId};t.prototype.x0g=function(P,Ba,ra){var ta=0;var Ia,bb;for(Ba.reset();Ia=Ba.getNextCell();)Ja.e(Ia.formula)&&ta++,(bb=ra?P.getCell(Ia.row,Ia.col):null)?this.t0g(Ba,Ia,bb):this.xCg(Ba,Ia);if(ra)for(P.reset();bb=P.getNextCell();)(Ia=Ba.getCell(bb.row,bb.col))||this.Gme(P,bb);return ta};t.prototype.Usj=function(){this.Km.setOnUpdateRequest(function(){})};t.prototype.Tsj=function(){var P=this;this.Km.setOnUnresponsive(function(Ba,ra,ta,Ia){P.NUi(Ba,
ra,ta,Ia)})};t.prototype.NUi=function(P,Ba,ra,ta){Q.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",P,Ba,ra,ta);ta&&(this.Phj(),this.woa())};t.prototype.Phj=function(){this.rd(null,null);this.Std=this.$Db=!1;this.ZEd=0;this.QEd=this.SEd=this.TEd=this.REd=-1};t.prototype.close=function(){this.Km.close()};t.prototype.clearCache=function(){this.Km.clearCache()};t.prototype.resumeRecalc=function(){this.Km.resumeRecalc()};
t.prototype.jsj=function(){this.Km.setA1ReferenceStyle(!0)};t.prototype.D7i=function(){if(this.instantaneousSupportInformationManager){var P=this.instantaneousSupportInformationManager.xdi,Ba=this.instantaneousSupportInformationManager.Adi,ra=this.instantaneousSupportInformationManager.zdi,ta=this.instantaneousSupportInformationManager.ydi,Ia=!1;P!==this.REd&&(Ia=!0,this.REd=P);Ba!==this.TEd&&(Ia=!0,this.TEd=Ba);ra!==this.SEd&&(Ia=!0,this.SEd=ra);ta!==this.QEd&&(Ia=!0,this.QEd=ta);var bb=[];Pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",
!1)&&(Ia=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),bb.push(Ia),Ia=!0);Pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Ia=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),bb.push(Ia),Ia=!0);Pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Ia=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),bb.push(Ia),Ia=!0);Ia&&(P=excelOnlineCalc.calc.recalcServiceConfig(null,P,
null,Ba,null,null,null,ra,bb,ta),this.Km.reconfigure(P))}};t.prototype.Wuj=function(P){var Ba=this,ra=null;if(this.Ye.xb(this.currentStateId))try{this.R$=[];var ta=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,za[P]);ra=this.Oc.Vb.Hc("ModelUpdate",ta);Ta.a.forEach(this.Ye.oa(this.currentStateId).q_a,function(Ia,bb){bb.kvc||(Ba.i9g(Ia,bb.awe,bb.sheetName),bb.kvc=!0)},null);this.Km.updateRanges(this.currentStateId,this.R$)}finally{ra&&ra.stop()}else Q.ULS.sendTraceTag(537170122,
0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};t.prototype.Vuj=function(){var P=[],Ba=this.Fwe(),ra=Ba&&this.Ye.oa(this.Zp).tj&&this.Ye.oa(this.Zp).tj[0]&&this.Ye.oa(this.Zp).tj[0].Dlc?this.Ye.oa(this.Zp).tj[0].b6:null;this.uBe(ra,this.Ye.oa(this.currentStateId).tj[0].b6,null,this.Zp,P);this.Ye.oa(this.currentStateId).tj[0].Dlc=!0;for(var ta=1;ta<this.Ye.oa(this.currentStateId).tj.length;ta++)ra=-1,Ba&&this.Ye.oa(this.Zp).tj&&(ra=this.dhd(this.Ye.oa(this.currentStateId).tj[ta].Jna.sheetName,
this.Zp)),ra=-1!==ra&&this.Ye.oa(this.Zp).tj[ra].Dlc?this.Ye.oa(this.Zp).tj[ra].b6:null,this.uBe(ra,this.Ye.oa(this.currentStateId).tj[ta].b6,this.Ye.oa(this.currentStateId).tj[ta].Jna.sheetId,this.Zp,P),this.Ye.oa(this.currentStateId).tj[ta].Dlc=!0;this.Km.updateNamedObjects(this.currentStateId,P)};t.prototype.uBe=function(P,Ba,ra,ta,Ia){if(void 0!==ra&&null!==ra){var bb=excelOnlineCalc.calc.undefinedNamesWrite(ra);Array.add(Ia,bb)}if(P){var Va=!1,lb=[];bb=[];if(Ba)for(var kc=yl(Ba),zb=kc.next();!zb.done;zb=
kc.next()){zb=zb.value;var Sb=zb.value;if(P.xb(zb.key)){var gb=P.oa(zb.key);t.bEi(gb,Sb)?Va=!0:(gb=excelOnlineCalc.calc.namedObject(zb.key,null),Array.add(lb,gb),t.uUc(zb.key,Sb,bb))}else t.uUc(zb.key,Sb,bb)}P=yl(P);for(zb=P.next();!zb.done;zb=P.next())kc=zb.value,Ba&&Ba.xb(kc.key)||(kc=excelOnlineCalc.calc.namedObject(kc.key,null),Array.add(lb,kc));Va&&(Ba=excelOnlineCalc.calc.namedObjectsPromote(ra,ta),Array.add(Ia,Ba));0<lb.length&&(Ba=excelOnlineCalc.calc.namedObjectsWrite(ra,lb),Array.add(Ia,
Ba));0<bb.length&&(ra=excelOnlineCalc.calc.namedObjectsWrite(ra,bb),Array.add(Ia,ra))}else if(Ba){bb=[];Ba=yl(Ba);for(ta=Ba.next();!ta.done;ta=Ba.next())ta=ta.value,t.uUc(ta.key,ta.value,bb);0<bb.length&&(ra=excelOnlineCalc.calc.namedObjectsWrite(ra,bb),Array.add(Ia,ra))}};t.prototype.LOg=function(){return this.Ye.oa(this.currentStateId).q_a[this.sta]?(Q.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.sta,this.currentStateId),
!0):!1};t.prototype.DOg=function(P){return 1===P.getColumnNumbers().length&&P.getColumnNumbers()[0]===t.awd+1?!1:!0};t.prototype.nbi=function(){var P=this,Ba=!1;db.g(this.Oc).Ca.Ybd(function(ra){ra.state&1&&P.Oc.ea.uf===ra.ke.Revision&&(P.EFe(ra),Ba=!0)});return Ba};t.prototype.HDe=function(P,Ba){var ra=P.getRowNumbers(),ta=P.getColumnNumbers();P=ra[0]-1;ra=ra[ra.length-1]-1;var Ia=ta[0]-1;ta=ta[ta.length-1]-1;(Ba=this.Qvb(Ba))||Q.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",
this.Ye.xb(this.currentStateId)&&this.Ye.oa(this.currentStateId).tj?this.Ye.oa(this.currentStateId).tj.length:0);return t.BU("CreateBlockRangeLocation",Ba,P,Ia,ra,ta)};t.prototype.wCg=function(P,Ba,ra){if(ra=this.HDe(P,ra)){var ta=t.d4b(P.getRowNumbers());P=t.d4b(P.getColumnNumbers());Ba=excelOnlineCalc.calc.rangePromote(ra,Ba,ta,P);this.R$[this.R$.length]=Ba}};t.prototype.yCg=function(P,Ba){if(Ba=this.HDe(P,Ba)){var ra=t.d4b(P.getRowNumbers());P=t.d4b(P.getColumnNumbers());P=excelOnlineCalc.calc.rangeWrite(Ba,
null,ra,P);this.R$[this.R$.length]=P}};t.prototype.t0g=function(P,Ba,ra){var ta=null,Ia=0,bb=0;switch(Ba.valueType){case 2:ta=this.Uhd(Ba);var Va=this.Uhd(ra);Va=Xa.a.equals(Va,ta,!1);break;case 1:null===Ba.value&&null===ra.value?Va=!0:(Ia=parseFloat(Ba.value),Va=parseFloat(ra.value)===Ia);break;default:null===Ba.value&&null===ra.value?Va=!0:(bb=parseFloat(Ba.value),Va=bb===parseFloat(ra.value))}Va&&Ba.valueType===ra.valueType&&Ba.ifmt===ra.ifmt&&Ba.formulaType===ra.formulaType&&Xa.a.equals(ra.formula,
Ba.formula,!1)||(void 0!==Ba.formula&&null!==Ba.formula||void 0!==Ba.value&&null!==Ba.value||void 0!==Ba.text&&null!==Ba.text?this.yYb(P,Ba,ta,Ia,bb):this.Gme(P,Ba))};t.prototype.UBg=function(P){if(this.Oc.zb&&this.Oc.zb.items)for(var Ba=0;Ba<this.Oc.zb.count;Ba++){var ra=this.Oc.zb.items[Ba];if(2===ra.type||3===ra.type){var ta=0,Ia=ra.name,bb=Ia.lastIndexOf("!");if(0<bb){ta=Ia.substr(0,bb);"'"===ta.charAt(0)&&(ta=ta.substr(1,ta.length-2));ta=this.dhd(ta,this.currentStateId);if(-1===ta){Q.ULS.sendTraceTag(595096334,
0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Ye.xb(this.currentStateId)&&this.Ye.oa(this.currentStateId).tj?this.Ye.oa(this.currentStateId).tj.length:0);continue}Ia=Ia.substr(bb+1)}ta=this.Ye.oa(this.currentStateId).tj[ta].b6;var Va=ra.usedRange;2===ra.type&&(Va=Dc.a(ra));if(ta.xb(Ia)){if(bb=ta.oa(Ia),Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(bb.range=Va,bb.attributes=ra.attributes),2===bb.type&&
(Ia=t.lUe(ra.name,P),ra=(ta=Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?ra.QO:null===Ia||void 0===Ia?void 0:Ia.ColHeadersList,Ia||ta))if(!bb.oE)bb.oE=new B(ra);else if(ra)for(ra=yl(ra.HeadersList),Ia=ra.next();!Ia.done;Ia=ra.next())Ia=Ia.value,bb.oE.x$.ia(Ia.Index,Ia.Name)}else if(bb=this.Qvb(ra.sheetName)){bb=new r(ra.type,ra.name,Va,bb,ra.attributes);if(2===bb.type)if(Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&ra.QO)bb.oE=
new B(ra.QO);else if(ra=t.lUe(ra.name,P))bb.oE=new B(ra.ColHeadersList);ta.ia(Ia,bb)}else Q.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Ye.xb(this.currentStateId)&&this.Ye.oa(this.currentStateId).tj?this.Ye.oa(this.currentStateId).tj.length:0)}}};t.prototype.yYb=function(P,Ba,ra,ta,Ia){var bb=P.getRowNumbers()[Ba.row]-1;P=P.getColumnNumbers()[Ba.col]-1;bb=t.BU("AddRangeUpdateCommand",this.urb,bb,P,bb,P);P=null;var Va=
Ba.formula||Ba.text,lb=excelOnlineCalc.calc.blankValue,kc=null;void 0!==Ba.text&&null!==Ba.text||void 0!==Ba.value&&null!==Ba.value||(ra="",kc="This cell contains blanks only",0===Ba.formulaType&&(Va=""));switch(Ba.valueType){case 2:null!==ra&&(0===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData(Va,ra,Ba.ifmt,kc)),1===Ba.formulaType&&(P=excelOnlineCalc.calc.cellFormulaCellData(Va,ra,Ba.ifmt,kc)),2===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData("",lb,0,"This cell is a part of an array")));
break;case 1:isNaN(ta)?Q.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",Ba.row,Ba.col):(0===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData(Va,ta,Ba.ifmt,null)),1===Ba.formulaType&&(P=excelOnlineCalc.calc.cellFormulaCellData(Va,ta,Ba.ifmt,null)),2===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData("",lb,0,"This cell is a part of an array")));break;case 3:isNaN(Ia)?Q.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
Ba.row,Ba.col):(ra=1===Ia?!0:!1,0===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData(Va,ra,Ba.ifmt,null)),1===Ba.formulaType&&(P=excelOnlineCalc.calc.cellFormulaCellData(Va,ra,Ba.ifmt,null)),2===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData("",lb,0,"This cell is a part of an array")));break;case 4:isNaN(Ia)?Q.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",Ba.row,Ba.col):(ra=excelOnlineCalc.calc.errorValue(Ia),0===Ba.formulaType&&
(P=excelOnlineCalc.calc.valueCellData(Va,ra,Ba.ifmt,null)),1===Ba.formulaType&&(P=excelOnlineCalc.calc.cellFormulaCellData(Va,ra,Ba.ifmt,null)),2===Ba.formulaType&&(P=excelOnlineCalc.calc.valueCellData("",lb,0,"This cell is a part of an array")));break;default:P=excelOnlineCalc.calc.valueCellData("",lb,Ba.ifmt,null)}P&&(Ba=excelOnlineCalc.calc.rangeWrite(bb,P,null,null),this.R$[this.R$.length]=Ba)};t.prototype.xCg=function(P,Ba){switch(Ba.valueType){case 2:this.yYb(P,Ba,this.Uhd(Ba),null,0);break;
case 1:this.yYb(P,Ba,null,parseFloat(Ba.value),0);break;default:this.yYb(P,Ba,null,null,parseFloat(Ba.value))}};t.prototype.Gme=function(P,Ba){var ra=P.getRowNumbers()[Ba.row]-1;P=P.getColumnNumbers()[Ba.col]-1;ra=t.BU("AddRangeUpdateCommandEmptyCell",this.urb,ra,P,ra,P);Ba=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,Ba.ifmt,null);Ba=excelOnlineCalc.calc.rangeWrite(ra,Ba,null,null);this.R$[this.R$.length]=Ba};t.prototype.Qvb=function(P){P=this.dhd(P,this.currentStateId);
return 0<P?this.Ye.oa(this.currentStateId).tj[P].Jna.sheetId:null};t.prototype.dhd=function(P,Ba){if(!this.Ye.xb(Ba))return Q.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",Ba),-1;if(!this.Ye.oa(Ba).tj)return Q.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",Ba),-1;Ba=this.Ye.oa(Ba).tj;for(var ra=1;ra<Ba.length;ra++)if(Xa.a.equals(Ba[ra].Jna.sheetName,P,!1))return ra;
return-1};t.prototype.ruj=function(){if(!this.Ye.xb(this.currentStateId)||!this.Ye.oa(this.currentStateId).tj.length)return Q.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var P=[],Ba=1;Ba<this.Ye.oa(this.currentStateId).tj.length;Ba++){var ra=this.Ye.oa(this.currentStateId).tj[Ba];ra&&Array.add(P,ra.Jna)}this.Km.updateSheetNames(this.currentStateId,P);this.Km.updateUnusedCells(this.currentStateId,
this.Ye.oa(this.currentStateId).Jcg);return!0};t.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var P=[],Ba=yl(this.instantaneousSupportInformationManager.mca),ra=Ba.next();!ra.done;ra=Ba.next())ra=ra.value,ra=excelOnlineCalc.calc.numberFormat(ra.IfmtIndex,ra.FormatString,ra.Builtin),Array.add(P,ra);this.Km.setNumberFormats(P,!0)}};t.prototype.Mqj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Je){var P=
this.qbi();if(!this.Std||P)this.c4b(),this.instantaneousSupportInformationManager.Je.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Je.TrueValueString),this.instantaneousSupportInformationManager.Je.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Je.FalseValueString),P=ya.CalcHelper.xEe(this.instantaneousSupportInformationManager,P),this.Km.setLocale(P),this.Std=!0}};t.prototype.gvj=function(){var P=null;if(void 0!==this.Oc.workbookContext.TimeZoneInformation&&
null!==this.Oc.workbookContext.TimeZoneInformation){P=null;this.Oc.workbookContext.TimeZoneInformation.StandardDate.Month&&(P=excelOnlineCalc.date.dateTime(this.Oc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Oc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Oc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Oc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Oc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Oc.workbookContext.TimeZoneInformation.StandardDate.Second,
this.Oc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Oc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var Ba=null;this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(Ba=excelOnlineCalc.date.dateTime(this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Hour,
this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Oc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Oc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));P=excelOnlineCalc.date.tzData(this.Oc.workbookContext.TimeZoneInformation.Bias,P,this.Oc.workbookContext.TimeZoneInformation.StandardBias,Ba,this.Oc.workbookContext.TimeZoneInformation.DaylightBias)}else Q.ULS.sendTraceTag(537170082,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");P=excelOnlineCalc.calc.workbookProps(this.Oc.workbookContext.F1904,this.Oc.workbookContext.FDateCompatibility,P);this.Km.setWorkbookProps(P)};t.prototype.woa=function(){var P=this;Pa.EwaSettings.la(310)&&ib.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.R5f,!0)).continueWith(function(ra){ra.exception?Q.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",ra.exception.toString()):Q.ULS.sendTraceTag(537170080,
0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var Ba=Pa.EwaSettings.la(682)?z.local:z.pKj;this.aHd=ib.c(excelOnlineCalc.calc.createRecalcService(Ba,Mb.a.a_()));this.aHd.continueWith(function(ra){ra.exception?Q.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",ra.exception.toString()):(Q.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),P.Km=P.aHd.result,P.Km?
P.Teb(0)?P.Tsj():Q.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):Q.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};t.prototype.qbi=function(){var P=this.instantaneousSupportInformationManager.sja;if(!P||this.ZEd===P.length)return null;this.ZEd=P.length;return ya.CalcHelper.kEe(P)};t.prototype.c4b=function(){this.errorTypeNames=ya.CalcHelper.c4b()};t.prototype.sbi=function(){if(!(this.Ye.xb(this.currentStateId)&&
0<this.Ye.oa(this.currentStateId).tj.length)){this.Ye.ia(this.currentStateId,new C);this.Ye.oa(this.currentStateId).tj[0]=new u(null);for(var P=this.Oc.xa,Ba=0;Ba<P.count;Ba++){var ra=Object(ob.a)(vb.a,P.getItem(Ba));if(ra){void 0!==ra.sheetId&&null!==ra.sheetId&&void 0!==ra.name&&null!==ra.name&&ra.sheetId.length&&ra.sheetName.length||Q.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",Ba,ra.sheetId,ra.hash,ra.name?
ra.name.length:-1);var ta=excelOnlineCalc.calc.sheetName(ra.sheetId,ra.name);this.Ye.oa(this.currentStateId).tj[Ba+1]=new u(ta);ta=ra.usedRange.HL();ta=excelOnlineCalc.calc.rangeLocation(0,0,ta.LastRow,ta.LastColumn);ra=excelOnlineCalc.calc.unusedCellsUpdate(ra.sheetId,ta);Array.add(this.Ye.oa(this.currentStateId).Jcg,ra)}else Q.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,Ba)}}};t.prototype.WXg=function(){for(var P=
yl(this.Ye),Ba=P.next();!Ba.done;Ba=P.next())Ba=Ba.value,Ba.key<this.Zp&&this.Ye.remove(Ba.key)};t.prototype.Uhd=function(P){P=P.value||P.text;if(void 0===P||null===P)P="";return P};t.prototype.vcg=function(){if(!this.Ye.xb(this.currentStateId))return!1;var P=!1;Ta.a.forEach(this.Ye.oa(this.currentStateId).q_a,function(Ba,ra){ra.kvc||(P=!0)},null);return P};t.prototype.d4c=function(P){var Ba={};Ba.reason=P;Ba.kind=1;return Ba};t.prototype.Qgc=function(){return this.Ye.xb(this.currentStateId)&&this.Ye.oa(this.currentStateId).tj&&
this.Ye.oa(this.currentStateId).tj[0]&&this.Ye.oa(this.currentStateId).tj[0].b6?!0:!1};t.q5g=function(P){var Ba=[];if(null===P||void 0===P?0:P.x$){P=yl(P.x$);for(var ra=P.next();!ra.done;ra=P.next())ra=ra.value,ra=excelOnlineCalc.calc.columnData(ra.key,ra.value),Array.add(Ba,ra)}return Ba};t.bEi=function(P,Ba){if(P.type!==Ba.type||P.attributes!==Ba.attributes||!Xa.a.equals(P.fullName,Ba.fullName,!1)||!P.range.equals(Ba.range))return!1;if(!P.oE&&!Ba.oE)return!0;if(!P.oE||!Ba.oE||P.oE.x$.count!==Ba.oE.x$.count)return!1;
var ra={};P=yl(P.oE.x$);for(var ta=P.next();!ta.done;ra={Zfb:ra.Zfb,fgb:ra.fgb},ta=P.next())if(ra.Zfb=ta.value,ra.fgb=void 0,!(ra.Zfb.value&&function(Ia){return function(){var bb=Ba.oE.x$.Gc(Ia.Zfb.key);Ia.fgb=bb.value;return bb}}(ra)().returnValue&&ra.fgb&&Xa.a.equals(ra.Zfb.value,ra.fgb,!1)))return!1;return!0};t.uUc=function(P,Ba,ra){var ta=t.BU("NamedObject",Ba.sheetId,Ba.range.top-1,Ba.range.left-1,Ba.range.bottom-1,Ba.range.right-1);if(2===Ba.type){var Ia=!!(Ba.attributes&16),bb=!!(Ba.attributes&
8);Ba=t.q5g(Ba.oE);ta=excelOnlineCalc.calc.namedTableData(ta,Ia,bb,Ba);P=excelOnlineCalc.calc.namedObject(P,ta)}else ta=excelOnlineCalc.calc.namedRangeData(ta),P=excelOnlineCalc.calc.namedObject(P,ta);Array.add(ra,P)};t.nYe=function(P){var Ba=Sys.Serialization.JavaScriptSerializer.serialize(P.getRowNumbers());P=Sys.Serialization.JavaScriptSerializer.serialize(P.getColumnNumbers());return Ba+P};t.d4b=function(P){var Ba=null;if(1<P.length)for(var ra=1;ra<P.length;ra++)for(var ta=0;P[ra-1]+1+ta<P[ra];)Ba=
Ba||[],Array.add(Ba,P[ra-1]+ta),ta++;return Ba};t.lUe=function(P,Ba){if(!Ba)return null;for(var ra=0,ta=Ba.length;ra<ta;++ra)if(Xa.a.equals(P,Ba[ra].Name,!1))return Ba[ra];return null};t.BU=function(P,Ba,ra,ta,Ia,bb){function Va(lb,kc,zb,Sb){(0>zb||zb>=Sb)&&Q.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",lb,kc,zb)}void 0!==Ba&&null!==Ba||Q.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",
P);Va(P,"top",ra,t.gqf);Va(P,"left",ta,t.awd);Va(P,"bottom",Ia,t.gqf);Va(P,"right",bb,t.awd);return excelOnlineCalc.calc.sheetRangeLocation(Ba,ra,ta,Ia,bb)};t.gqf=1048576;t.awd=16384;Object(F.a)(t,"CalcAsyncEngine",null,[3]);Object(F.a)(y,"AbsoluteRelativeReferenceInfo",null,[]);var ub=b(1128),Eb=b(24);x.IIf="#";Object(F.a)(x,"Operators",null,[]);var Ya=b(1129);f.sheet="Sheet";f.sheetRange="SheetRange";f.document="Document";f.e9h="Ident";Object(F.a)(f,"TraverseFormulaQualifierTypes",null,[]);var tb=
b(1130),ec=b(1019),Za=b(924),mb=b(52),sc=b(59);m.prototype.dispose=function(){var P=this;Q.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.Za(268,function(Ba){Ba.yJd(P.wnc);Ba.mJd(P.anc)});this.gridView&&(this.gridView.pt(this.onContentReady),this.gridView.Ca&&this.gridView.Ca.tQf(this.mvf),this.Dy=null);this.Ktf=this.Itf=this.NFc=null};m.prototype.NTg=function(P,Ba,ra,ta){ta=void 0===ta?null:ta;this.wl&&(Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?
this.wl.KTg(P,Ba,ra,ta):this.wl.MTg(P,Ba,ra,ta))};m.prototype.evalFormula=function(P){return this.wl?this.wl.evalFormula(P):Promise.reject("calc engine not initialized")};m.prototype.evalFormulaRange=function(P,Ba,ra){return this.wl?this.wl.evalFormulaRange(P,Ba,ra):Promise.reject("calc engine not initialized")};m.prototype.Vsb=function(P,Ba,ra,ta){return this.wl?this.wl.Vsb(P,Ba,ra,ta):Promise.reject("CalcEngine is null")};m.prototype.Wvb=function(P){return this.wl?(Q.ULS.shipAssertTag(537170059,
0,2===P.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.wl.Wvb(P)):null};m.prototype.aJg=function(P,Ba){if(!Ba||2!==P.type)return!1;P=Dc.a(P);return P.right-P.left+1===Ba.count};m.prototype.MSe=function(P){if(!this.ZEb)return this.Igg||Q.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var Ba=this.dta(Eb.Range.kd(1,1));Ba=this.ZEb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Ba.range),P);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(Ba))return Q.ULS.sendTraceTag(537170056,
0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(Pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var ra=this.gridView.ha.va.activeCell,ta=excelOnlineCalc.location.gridCell(ra.top-1,ra.left-1),Ia=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),bb=excelOnlineCalc.location.sheetIndex(Ia,this.$.xa.pa.sheetId),Va=this.C9g(ta,bb);this.tLd||(this.tLd=excelOnlineCalc.util.createResolver(this.B9g()));
var lb=excelOnlineCalc.parse.parseResultHelper.extractReferences(Ba,this.Tr.config.localeInfo,Pa.EwaSettings.la(620),Va,this.tLd)}else lb=excelOnlineCalc.parse.parseResultHelper.extractReferences(Ba,this.Tr.config.localeInfo,Pa.EwaSettings.la(620));Pa.EwaSettings.la(103)&&this.TTj(lb,P);return lb}catch(kc){return Q.ULS.sendTraceTag(537170055,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",kc.message),null}};m.prototype.extractLetVariables=function(P,Ba){if(!this.ZEb)return this.Igg||
Q.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var ra=this.dta(Eb.Range.kd(1,1));P=this.ZEb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ra.range),P);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(P))return Q.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(P,Ba,this.Tr.config.localeInfo)}catch(ta){return Q.ULS.sendTraceTag(537170052,
0,10,"CalcManager.ExtractLetVariables - exception: {0}",ta.message),null}};m.prototype.extractReferences=function(P,Ba,ra,ta){if(!Ba)return Q.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!ra)return Q.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var Ia=this.MSe(P);if(!Ia)return Q.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.D8g(Ia,
Ba,ra,P,ta)}catch(bb){return Q.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",bb.message),null}};m.prototype.TZh=function(P,Ba,ra,ta){if(!P)return Q.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!Ba||0>=Ba.length)return Q.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;P=this.dta(P);if(!this.Tr||!P)return null;var Ia=
this.Dub(P).returnValue;if(!Ia||Ia.c6a)return null;ra=excelOnline.utils.getCharIndexInTextFromPoint(ra,ta,Pa.EwaSettings.la(620));return 0>ra?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Tr.config,ra,Ba,P)};m.prototype.BTg=function(P,Ba,ra,ta){var Ia=this;if(!P)return Q.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var bb=null;return this.evalFormula(Ba).then(function(Va){var lb=Ia.Tr.Imh(Va,ra),kc=lb.returnValue;8!==
lb.kind||kc.length&&kc!==ya.CalcHelper.unknownError?Va=0:(Q.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),Va=excelOnlineCalc.calc.getEvalFailureReason(Va),void 0!==Va&&null!==Va||Q.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),Va=1);return bb=ta?new ub.a(kc,ta.start,ta.end,Va):new ub.a(kc,-1,-1,Va)},function(Va){Q.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",
Va);return Promise.resolve(bb)})};m.prototype.getSubExpressionSpan=function(P){return this.Tr&&P?excelOnlineCalc.runtime.getSubExpressionSpan(P):null};m.prototype.getFormulaSubExpressionObject=function(P,Ba,ra){return this.Tr&&P&&Ba&&ra?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Tr.config,Ba,ra,this.dta(P)):null};m.prototype.WZh=function(P,Ba,ra){return this.Tr&&P&&Ba?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Tr.config,Ba,ra,this.dta(P)):null};m.prototype.UZh=
function(P,Ba,ra){return this.Tr&&P&&Ba?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Tr.config.localeInfo,Ba,ra):null};m.prototype.pTh=function(){return this.Tr?this.Tr.config.localeInfo.listSeparator:null};m.prototype.isFormulaSubExpressionVolatile=function(P){return this.Tr?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Tr.config.localeInfo,P):!1};m.prototype.dta=function(P){return P&&this.Tr?this.Tr.$9g(this.Tr.Pah(),P.top-1,P.left-1):null};m.prototype.Zii=function(P,Ba){P=
this.Yfd(P);if(void 0===P||null===P)return null;P=this.cq.createFormat(P.FormatString,P.Builtin);if(!excelOnlineCalc.util.isSuccess(P))return null;Ba=this.cq.parseEdit(Ba,P.value);return excelOnlineCalc.util.isSuccess(Ba)?Ba.value.kind===ec.a.formula:null};m.prototype.Xfd=function(P){if(!P.isValid())return Q.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",null!=P.UE?P.UE.toString():"null",P.formatString?Xa.a.AJ(P.formatString):
"null",P.numberFormat?"!null":"null"),null;var Ba=P.aSh();if("String"===Object.getType(Ba).getName())var ra=this.Ktf;else if("Number"===Object.getType(Ba).getName())ra=this.Itf;else return Q.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;Ba=Ba.toString();if(Ba in ra)return ra[Ba].numberFormat;ra[Ba]=P;return P.numberFormat};m.prototype.getWorksheetFuncId=function(P){return this.localeInfo.getWorksheetFuncId(P)};m.prototype.D8g=function(P,Ba,ra,ta,Ia){for(var bb=
{Items:[]},Va=0;Va<P.length;Va++){var lb=P[Va],kc={};kc.Start=lb.span.start;kc.End=lb.span.end;if(Ia||lb.kind!==Ya.a.func)if(Ia||lb.kind!==Ya.a.eti){if(this.Fhh(lb,Ba,ra)){var zb=new y,Sb=this.VWh(lb,Ba,zb,ta);if(Pa.EwaSettings.la(620)){var gb=this.fTh(lb),Sa=this.eTh(lb);if(Sb||Sa&&0<=gb)kc={Span:kc,LetNumber:gb,LetName:Sa,Range:Sb},kc.IsRangeRef=zb.L6a,kc.IsAbsoluteFirstRow=zb.ywa,kc.IsAbsoluteFirstColumn=zb.xwa,kc.IsAbsoluteSecondRow=zb.LLa,kc.IsAbsoluteSecondColumn=zb.KLa,kc.IsStructRef=lb.kind===
Ya.a.$Td,Array.add(bb.Items,kc)}else Sb&&(kc={Span:kc,Range:Sb},kc.IsRangeRef=zb.L6a,kc.IsAbsoluteFirstRow=zb.ywa,kc.IsAbsoluteFirstColumn=zb.xwa,kc.IsAbsoluteSecondRow=zb.LLa,kc.IsAbsoluteSecondColumn=zb.KLa,kc.IsStructRef=lb.kind===Ya.a.$Td,Array.add(bb.Items,kc))}}else lb=lb.ref.value.oper.kind,Array.add(bb.Items,{Span:kc,IsString:2===lb,IsBoolean:4===lb,IsNumber:1===lb});else kc.End=lb.span.start+lb.ref.name.length,lb={Span:kc,IsFunction:!0},lb.FunctionId=this.getWorksheetFuncId(ta.substring(kc.Start,
kc.End)),Array.add(bb.Items,lb)}bb.Items.sort(function(Kb,Gc){return Kb.Span.Start-Gc.Span.Start});return bb};m.prototype.fTh=function(P){return P.kind===Ya.a.olf?P.ref.number:-1};m.prototype.eTh=function(P){return P.kind===Ya.a.olf?P.ref.name:null};m.prototype.VWh=function(P,Ba,ra,ta){if(P.kind===Ya.a.range)return ra.L6a=!0,this.GCe(P,Ba,ra,ta);if(P.kind===Ya.a.namedRange){ra=P.ref;(P=this.$.zb.getItemByName(ra.name))||(P=this.$.zb.getItemByName(Ba+"!"+ra.name));if(!(P&&P.sheetName&&P.usedRange&&
Xa.a.equals(P.sheetName,Ba,!0)))return null;Ba=2===P.type?Dc.a(P):P.usedRange;return cb.m(Ba,P)}if(P.kind===Ya.a.$Td){var Ia=P.ref,bb;Ia.name?(bb=this.$.zb.getItemByName(Ia.name))||(bb=this.$.zb.getItemByName(Ba+"!"+Ia.name)):bb=this.gridView.Rb.Xj(this.gridView.ha.va.activeCell);if(!(bb&&bb.sheetName&&bb.usedRange&&Xa.a.equals(bb.sheetName,Ba,!0)))return null;ra.L6a=!1;return this.GCe(P,Ba,ra,ta)}return null};m.prototype.GCe=function(P,Ba,ra,ta){P=P.ref;if(P.type){if(P.type===tb.a.column){var Ia=
P.startIndex;P=P.endIndex;ra.xwa=Ia.kind===Za.a.abs;ra.KLa=P.kind===Za.a.abs;return this.createRange(0,Ia.index,S.a.Lh,P.index,Ba)}if(P.type===tb.a.row)return Ia=P.endIndex,ra.ywa=P.startIndex.kind===Za.a.abs,ra.LLa=Ia.kind===Za.a.abs,this.createRange(P.startIndex.index,0,P.endIndex.index,S.a.Xh,Ba);if(P.type===tb.a.cell){Ia=P.row;var bb=P.col;ra.ywa=ra.LLa=Ia.kind===Za.a.abs;ra.xwa=ra.KLa=bb.kind===Za.a.abs;return this.w1b(P.span.end,ta)&&(ra=Eb.Range.kd(Ia.index+1,bb.index+1),ra=this.gridView.Rb.P3e(ra))?
cb.n(ra,Ba):this.createRange(Ia.index,bb.index,Ia.index,bb.index,Ba)}if(P.type===tb.a.range){Ia=P.top;bb=P.left;ta=P.bottom;P=P.right;var Va=Math.min(Ia.index,ta.index),lb=Math.min(bb.index,P.index),kc=Math.max(Ia.index,ta.index),zb=Math.max(bb.index,P.index);ra.ywa=Ia.kind===Za.a.abs;ra.LLa=ta.kind===Za.a.abs;ra.xwa=bb.kind===Za.a.abs;ra.KLa=P.kind===Za.a.abs;return this.createRange(Va,lb,kc,zb,Ba)}Q.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",
P.type);return null}Q.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};m.prototype.w1b=function(P,Ba){return Ba.length>=P&&0<P&&Ba.charAt(P-1)===x.IIf};m.prototype.HTg=function(P,Ba,ra){this.wl&&this.wl.LTg(P,Ba,ra)};m.prototype.Yfd=function(P){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.mca&&this.instantaneousSupportInformationManager.mca[P]&&this.cq?this.instantaneousSupportInformationManager.mca[P]:
null};m.prototype.toXLNumber=function(P){if(!this.cq)return null;P=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.cq,P);return excelOnlineCalc.util.isSuccess(P)?P.value:null};m.prototype.TTj=function(P,Ba){if(P){P=yl(P);for(var ra=P.next();!ra.done;ra=P.next())if(ra=ra.value,ra.ref.type&&ra.ref.type===tb.a.cell){var ta=ra.ref;m.o0i(ta,Ba)&&(ta.span.end+=1,ra.span.end+=1)}}};m.prototype.createRange=function(P,Ba,ra,ta,Ia){var bb={};bb.FirstRow=P;bb.FirstColumn=Ba;bb.LastRow=ra;bb.LastColumn=
ta;bb.SheetName=Ia;return bb};m.prototype.Fhh=function(P,Ba,ra){var ta=P.ref.qualifier;if(!ta)return!0;switch(P.ref.qualifier.type){case f.sheet:return P=ta.document,Xa.a.equals(ta.sheet,Ba,!0)&&(!P||Xa.a.equals(P.document,ra,!0));case f.sheetRange:return Ba=this.$.xa.getItemByName(Ba),ra=this.$.xa.getItemByName(ta.sheet1),ta=this.$.xa.getItemByName(ta.sheet2),!!Ba&&!!ra&&!!ta&&(ra.index<=Ba.index&&Ba.index<=ta.index||ta.index<=Ba.index&&Ba.index<=ra.index);case f.document:return Xa.a.equals(ta.document,
ra,!0);case f.e9h:return ta=ta.name,Xa.a.equals(ta,Ba,!0)||Xa.a.equals(ta,ra,!0);default:return Q.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",ta.type),!1}};m.prototype.AOj=function(P){this.instantaneousSupportInformationManager=P;P.mca.length&&P.sja.length?(this.NFc=new ya.CalcHelper(this.gridView.$),this.ZEb=this.Tr.createParser(),this.uce=this.Tr.createNumberFormatter(),this.Ucf=!0,Q.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.wl||(Q.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.wl=new t(this.$))):Q.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",P.mca.length,P.sja.length.toString())};m.prototype.Dub=function(P){if(!P)return{returnValue:null,emptyCell:!1};var Ba=this.getSheetName(P.sheet.index);if(!Ba)return Q.ULS.sendTraceTag(537169998,
0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",P.sheet.index),{returnValue:null,emptyCell:!1};var ra=m.convertToRange(P);Ba=this.gridView.Dub(Ba,ra.top,ra.left);return Ba?Ba.Ahh?{returnValue:Ba,emptyCell:!1}:(Q.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",P.range.row,P.range.col),{returnValue:null,emptyCell:!0}):(Q.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",P.range.row,P.range.col),
{returnValue:null,emptyCell:!1})};m.prototype.getSheetName=function(P){var Ba=this.gridView.$.xa.getItem(P);return Ba?Ba.sheetName:(Q.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",P),null)};m.prototype.C9g=function(P,Ba){var ra={allowUnqualifiedCell:!0,wrapCellReferences:!0};ra.config=this.Tr.config;ra.originGridCell=excelOnlineCalc.util.success(P);ra.originSheet=excelOnlineCalc.util.success(Ba);return ra};m.prototype.B9g=function(){var P={};P.config=this.Tr.config;
P.getNameLoc=Object(Ka.a)(this.wl,this.wl.getNameLoc,"getNameLoc");P.getContainingTable=Object(Ka.a)(this.wl,this.wl.getContainingTable,"getContainingTable");P.getStructRefColumn=Object(Ka.a)(this.wl,this.wl.getStructRefColumn,"getStructRefColumn");P.getStructRefSpecialRef=Object(Ka.a)(this.wl,this.wl.getStructRefSpecialRef,"getStructRefSpecialRef");P.getDocumentLoc=Object(Ka.a)(this.wl,this.wl.getDocumentLoc,"getDocumentLoc");P.getSheetIndex=Object(Ka.a)(this.wl,this.wl.getSheetIndex,"getSheetIndex");
P.getSheetName=Object(Ka.a)(this.wl,this.wl.getSheetName,"getSheetName");P.getUserDefinedFuncLoc=Object(Ka.a)(this.wl,this.wl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");P.getSheetRangeIndexes=Object(Ka.a)(this.wl,this.wl.getSheetRangeIndexes,"getSheetRangeIndexes");return P};m.o0i=function(P,Ba){return Ba.length>P.span.end&&Ba.charAt(P.span.end)===x.IIf};m.convertToRange=function(P){return Eb.Range.kd(P.range.row+1,P.range.col+1)};Sk.Object.defineProperties(m.prototype,{Tr:{configurable:!0,enumerable:!0,
get:function(){return this.NFc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.Dy}},$:{configurable:!0,enumerable:!0,get:function(){return this.vb}},cq:{configurable:!0,enumerable:!0,get:function(){return this.uce}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Tr?this.Tr.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Tr.config}}});Object(F.a)(m,"CalcManager",null,[690,3]);var pd=b(35),$b=b(53),Xb=la.a;vm(n,Xb);
n.prototype.create=function(){var P=this;if(this.$){Q.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(Pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var Ba=53;var ra="Current"}else Ba=56,ra="Stable";Q.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",ra);pd.TaskExtensions.Ba($b.a.loadScript(Ba,4,this.ub,void 0,void 0,265),function(){Q.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
var ta=P.$.da.Aa(266,!1);ta||(Q.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),ta=new m(P.$));P.Fb(ta)},this.ma,3)}else Q.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};n.ja=function(P){P&&P.da&&P.da.Ha(265,new n(P))};Object(F.a)(n,"CalcManagerFactory",la.a,[]);var lc=b(4),Oa=b(319);Object(F.a)(l,"MarqueeMetadata",null,[]);var pb=b(131),Ub=b(647),ic=b(336);e.prototype.wX=
function(P,Ba){this.tki&&P.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.x8f||P.lN)return!1;var ra=void 0===Ba||null===Ba?P.text:Ba;if(this.calcManager&&1<ra.length&&Ja.e(ra)){var ta=this.lgd(),Ia=this.T1e(),bb=this.Oc.workbookContext.WorkbookFileName,Va=!1,lb=.01>Math.random()?Object(ob.a)(pb.a,this.Oc.Vb.Hc("LoadingUIShown","ColoredReferencesManager")):null;try{var kc=this.calcManager.extractReferences(ra,Ia,bb,!this.Acf);if(!kc)return Q.ULS.sendTraceTag(537169989,
0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;Ia=[];bb=[];for(var zb=[],Sb=[],gb=0,Sa=0,Kb=new qa.a(!1),Gc="",Hb=yl(kc.Items),Lb=Hb.next();!Lb.done;Lb=Hb.next()){var sa=Lb.value;Va=sa.IsStructRef||Va;if(sa.IsBoolean||sa.IsNumber||sa.IsString){var Ua=sa.IsBoolean?e.XOg:sa.IsNumber?e.LFi:e.yHj;this.AFa(bb,ra,gb,sa.Span.Start,null);this.AFa(bb,ra,sa.Span.Start,sa.Span.End,Ua);gb=sa.Span.End}else if(Pa.EwaSettings.la(620)){if(sa.Range||
sa.LetName&&0<=sa.LetNumber){kc=null;if(sa.Range){var Yb=cb.D(sa.Range);kc=this.Kub(Yb,Kb,1);Array.add(Ia,new ic.a(Yb,ta))}else sa.LetName&&0<=sa.LetNumber&&(kc=Gc=this.CMh(sa.LetName,sa.LetNumber,Kb,Gc),Sa!==Kb.count&&P.colors.add(sa.Span.Start+"-"+sa.Span.End,this.colors[(Kb.count-1)%this.colors.length]));this.AFa(bb,ra,gb,sa.Span.Start,null);this.AFa(bb,ra,sa.Span.Start,sa.Span.End,kc);gb=sa.Span.End;Array.add(zb,sa.Span);var jc=bb.length-1;Array.add(Sb,new l(jc,bb[jc].text,sa));Sa=Kb.count}}else if(sa.Range){var md=
cb.D(sa.Range),jd=this.Kub(md,Kb,1);this.AFa(bb,ra,gb,sa.Span.Start,null);this.AFa(bb,ra,sa.Span.Start,sa.Span.End,jd);Array.add(Ia,new ic.a(md,ta));gb=sa.Span.End;Array.add(zb,sa.Span);var Zc=bb.length-1;Array.add(Sb,new l(Zc,bb[Zc].text,sa))}}this.AFa(bb,ra,gb,ra.length,null);this.Nuj(P,bb,!!Ba);var Qb=P.textBox.text;if(!Xa.a.equals(Qb,ra,!1)){Q.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",
Qb.length,ra.length);var fd=P.textBox.caretPosition;P.textBox.text=ra;P.textBox.caretPosition=fd;return!0}this.Ldc(Ia,Kb,Sb);Pa.EwaSettings.la(620)&&0<Ia.length&&Q.ULS.sendTraceTag(537169988,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");Pa.EwaSettings.la(620)&&0<P.colors.count&&Q.ULS.sendTraceTag(537169987,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.x5a=!0}finally{lb&&lb.UAa(function(){Va&&Q.ULS.sendTraceTag(537169986,
0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",lb.Dc)})}}else return this.Ldc(null,null),this.x5a&&(this.x5a=!1,ta=P.textBox.caretPosition,P.textBox.setPlainText(ra),P.textBox.caretPosition=Math.min(ta,ra.length),Ba)?!0:!1};e.prototype.srf=function(P,Ba,ra){if(!P||!Ba||!ra)return Q.ULS.shipAssertTag(537169985,0,!!P,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),Q.ULS.shipAssertTag(537169984,0,!!Ba,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),
Q.ULS.shipAssertTag(537169955,0,!!ra,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var ta=Object(ob.a)(l,Ba.metadata);if(!ta)return Q.ULS.shipAssertTag(537169954,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var Ia=ta.aKj,bb=ta.z9f,Va=this.gridView.Rb.Tdf(ra)?ra.Hac(ta.xwa,ta.ywa):ra.i4a(ta.xwa,ta.ywa,ta.KLa,ta.LLa);if(!Va)return Q.ULS.shipAssertTag(537169953,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var lb=bb.indexOf("!");
-1!==lb&&(Va=bb.substring(0,lb+1)+Va);if(!P.textBox.changeTextInExistingTextPart(Ia,bb,Va))return Q.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;ta.z9f=Va;Ia=!0;for(bb=1;4>=bb;bb++)(Va=db.g(this.Oc).Nb.ZE(3,bb,Ba.y$))?(Va.range=ra,Va.metadata=ta):(Q.ULS.shipAssertTag(537169952,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),Ia=!1);this.gridView.Nb.update(!1,!1);this.gridView.pc.Dj&&(this.gridView.pc.textBox.text=
P.text);this.gridView.pc.$Fb(new Oa.a({xyb:!0}));return Ia};e.prototype.xki=function(P){if(3!==P.mr)return Q.ULS.shipAssertTag(537169951,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;P=Object(ob.a)(l,P.metadata);return P?P.L6a&&!P.ohc:(Q.ULS.shipAssertTag(537169950,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};e.prototype.Pdb=function(P,Ba){Q.ULS.sendTraceTag(537169949,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+
(Ba?"suspending":"resuming")+" colored references");!Ba||this.lif&&!this.x5a||(this.lif&&(this.x5a=!1),this.Ldc(null,null),P.textBox.tYg());this.x8f=Ba};e.prototype.dispose=function(){this.gridView&&this.gridView.yc&&this.gridView.yc.Pn(this.$Cb)};e.prototype.d8h=function(P){var Ba=this.lgd(),ra=this.T1e(),ta=this.Oc.workbookContext.WorkbookFileName,Ia=[],bb=new qa.a(!1),Va=[];if(ra=this.calcManager.extractReferences(P,ra,ta,!this.Acf)){ra=yl(ra.Items);for(ta=ra.next();!ta.done;ta=ra.next())if(ta=
ta.value,ta.Range){var lb=cb.D(ta.Range);Array.add(Ia,new ic.a(lb,Ba));this.Kub(lb,bb,1);Array.add(Va,new l(ta.Span.Start,P.substring(ta.Span.Start,ta.Span.End),ta,!0))}this.Ldc(Ia,bb,Va)}};e.prototype.Kub=function(P,Ba,ra){var ta=Ba.getItem(P.toString());ta||(ta=this.colors[Ba.count%this.colors.length],Ba.add(P.toString(),ta));return String.format(ta,ra)};e.prototype.CMh=function(P,Ba,ra,ta){P="["+P+", "+Ba+"]";Ba=ra.getItem(P);Ba||(Ba=ra.count%this.colors.length,Ba=this.colors[Ba],ta===String.format(Ba,
1)&&(ra.add("skip-"+P,Ba),Ba=ra.count%this.colors.length,Ba=this.colors[Ba]),ra.add(P,Ba));return String.format(Ba,1)};e.prototype.AFa=function(P,Ba,ra,ta,Ia){Q.ULS.shipAssertTag(537169948,0,ra<=ta,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");ra<ta&&(Ba=Ba.substring(ra,ta),Array.add(P,Object.assign(new Ub.a,{text:Ba,color:Ia})))};e.prototype.Ldc=function(P,Ba,ra){var ta=this;ra=void 0===ra?null:ra;P&&P.length?(Q.ULS.sendTraceTag(537169947,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+
P.length),P.reverse(),ra.reverse(),this.gridView.Nb.ry(P,[3],!0,function(Ia,bb){if(Ia&&Ia.range&&bb){Q.ULS.shipAssertTag(537169943,0,Ba.xb(Ia.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",Ia.range.toString());var Va=ta.Kub(Ia.range,Ba,.1),lb=ta.Kub(Ia.range,Ba,1);ta.Oc.frame&&ta.Oc.frame.zH&&ta.Oc.frame.zH.Mka||(bb.style.background=Va);bb.style.borderColor=lb;ra&&(bb.setAttribute(lc.a.Cxb,Ia.y$.toString()),Ia.metadata=
ra[Ia.y$])}else Q.ULS.shipAssertTag(537169946,0,!!Ia,"ColoredReferencesManager.HighlightRanges: state is null"),Q.ULS.shipAssertTag(537169945,0,!!Ia.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),Q.ULS.shipAssertTag(537169944,0,!!bb,"ColoredReferencesManager.HighlightRanges: div is null")})):(P=this.Oc.Vb.Hc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Nb.ll([3]),this.gridView.Nb.NJb(new ic.a(null,this.lgd()),[3]),P.stop())};e.prototype.Nuj=function(P,Ba,ra){var ta=
P.textBox;ta.pK=!0;var Ia=ta.selection,bb=Ia.index;Ia=bb+Ia.length;ta.setTextFromTextParts(Ba);Ba=ta.text.length;ta.selectRange(Math.min(bb,Ba),Math.min(Ia,Ba));ra&&P.$Fb(new Oa.a);ta.pK=!1};e.prototype.lgd=function(){return this.S1e().sheetId};e.prototype.T1e=function(){return this.S1e().sheetName};e.prototype.S1e=function(){return this.gridView.nt&&this.gridView.nt.XK?this.gridView.nt.XK:this.Oc.pa};e.LFi="rgba(9, 134, 88, 1)";e.XOg="rgba(0, 0, 255, 1)";e.yHj="rgba(163, 21, 21, 1)";Object(F.a)(e,
"ColoredReferencesManager",null,[611,3]);var Jb=la.a;vm(c,Jb);c.prototype.create=function(){var P=this;this.$.da.Za(266,function(Ba){P.Fb(new e(P.$,Ba))})};c.ja=function(P){P.da.Ha(282,new c(P))};Object(F.a)(c,"ColoredReferencesManagerFactory",la.a,[]);var cc=b(935),Ob=la.a;vm(a,Ob);a.prototype.create=function(){var P=this;this.$.da.Za(266,function(Ba){P.Fb(new cc.RelativeAndAbsoluteReferencesManager(Ba))})};a.ja=function(P){P.da.Ha(295,new a(P))};Object(F.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",
la.a,[]);Type.registerNamespace("_Ewa");A.a.Ga(v.ja);A.a.Ga(n.ja);A.a.Ga(c.ja);A.a.Ga(a.ja)},924:function(A,F,b){function a(){}b.d(F,"a",function(){return a});A=b(0);a.abs="Abs";a.rel="Rel";Object(A.a)(a,"PositionBaseType",null,[])},935:function(A,F,b){function a(D){this.calcManager=D}function c(){return y.call(this)||this}function e(){this.Luc=this.firstRow=null;return this}function l(){return y.call(this)||this}function n(){this.right=this.left=this.bottom=this.top=null;return this}function m(){return y.call(this)||
this}function f(){this.Kuc=this.firstColumn=null;return this}function x(){var D=y.call(this)||this;D.mhc=!1;return D}function y(){this.end=this.start=0;this.gv=null}function t(){this.column=this.row=null;return this}function B(){}b.r(F);A=b(0);var z=b(13);Object(A.a)(B,"Reference",null,[]);vm(t,B);Object(A.a)(t,"CellReference",B,[]);y.prototype.BKg=function(D,V){for(var U=0;U<this.gv.length;U++){var Q=this.g_b(D,this.gv[U]);V+=Q;U<this.gv.length-1&&(V+=":")}return V};Object(A.a)(y,"IReferenceSequence",
null,[]);var u=b(24),C=b(924);vm(x,y);x.prototype.wbc=function(){var D=b(935).RelativeAndAbsoluteReferencesManager,V=this.gv[0];return D.ysf(V.row.kind===C.a.abs,V.column.kind===C.a.abs)};x.prototype.g_b=function(D,V){V=u.Range.kd(V.row.index+1,V.column.index+1);return this.mhc?V.Hac(1===D||3===D,1===D||2===D):V.i4a(1===D||3===D,1===D||2===D,!0,!0)};Object(A.a)(x,"CellReferenceSequence",y,[]);vm(f,B);Object(A.a)(f,"ColumnReference",B,[]);vm(m,y);m.prototype.wbc=function(){var D=this.gv[0];return b(935).RelativeAndAbsoluteReferencesManager.Tqf(D.firstColumn,
D.Kuc).kind===C.a.abs?2:3};m.prototype.g_b=function(D,V){return u.Range.cub(V.firstColumn.index+1,V.Kuc.index+1).i4a(1===D||3===D,!0,1===D||3===D,!0)};Object(A.a)(m,"ColumnReferenceSequence",y,[]);vm(n,B);Object(A.a)(n,"RangeReference",B,[]);vm(l,y);l.prototype.wbc=function(){var D=b(935).RelativeAndAbsoluteReferencesManager,V=this.gv[0];return D.ysf(V.top.kind===C.a.abs,V.left.kind===C.a.abs)};l.prototype.g_b=function(D,V){V=new u.Range(V.top.index+1,V.left.index+1,V.bottom.index+1,V.right.index+
1,!1,!1);var U=1===D||3===D;D=1===D||2===D;return V.i4a(U,D,U,D)};Object(A.a)(l,"RangeReferenceSequence",y,[]);vm(e,B);Object(A.a)(e,"RowReference",B,[]);vm(c,y);c.prototype.wbc=function(){var D=this.gv[0];return b(935).RelativeAndAbsoluteReferencesManager.Tqf(D.firstRow,D.Luc).kind===C.a.abs?0:1};c.prototype.g_b=function(D,V){return u.Range.s$b(V.firstRow.index+1,V.Luc.index+1).i4a(!0,1===D||2===D,!0,1===D||2===D)};Object(A.a)(c,"RowReferenceSequence",y,[]);var r=b(1129),J=b(1130),v=b(193);b.d(F,
"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.$0a=function(D,V,U){var Q=V;var la=U;if(!D||!v.e(D))return{returnValue:D,Qxd:Q,Pxd:la};var ba=this.calcManager.MSe(D);if(!ba)return z.ULS.sendTraceTag(537169940,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,Qxd:Q,Pxd:la};ba=this.FYh(ba,D,V,U);for(var T=0,H="",S=0,K=0;K<ba.length;K++)if(this.HJe(ba[K],V,U)){T=ba[K].wbc();
Q=ba[K].start;break}for(;K<ba.length&&this.HJe(ba[K],V,U);K++)H+=D.substring(S,ba[K].start),H=ba[K].BKg(T,H),S=ba[K].end;S&&(la=H.length);H+=D.substring(S,D.length);return{returnValue:H,Qxd:Q,Pxd:la}};a.prototype.FYh=function(D,V,U,Q){for(var la=[],ba=0;ba<D.length;ba++){var T=D[ba];if(T.kind===r.a.range)if(T=T.ref,T.type===J.a.cell){var H=T;T=Object.assign(new x,{start:T.span.start,end:T.span.end,gv:[Object.assign(new t,{column:H.col,row:H.row})],mhc:this.calcManager.w1b(T.span.end,V)});la.push(T)}else if(T.type===
J.a.range)this.IJe(T.topLeftSpan,U,Q)&&this.IJe(T.bottomRightSpan,U,Q)?(H=new n,T.top.index<=T.bottom.index?(H.top=T.top,H.bottom=T.bottom):(H.bottom=T.top,H.top=T.bottom),T.left.index<=T.right.index?(H.left=T.left,H.right=T.right):(H.right=T.left,H.left=T.right),T=Object.assign(new l,{start:T.topLeftSpan.start,end:T.bottomRightSpan.end,gv:[H]}),la.push(T)):(H=Object.assign(new x,{start:T.topLeftSpan.start,end:T.topLeftSpan.end,gv:[Object.assign(new t,{column:T.left,row:T.top})],mhc:this.calcManager.w1b(T.topLeftSpan.end,
V)}),T=Object.assign(new x,{start:T.bottomRightSpan.start,end:T.bottomRightSpan.end,gv:[Object.assign(new t,{column:T.right,row:T.bottom})],mhc:this.calcManager.w1b(T.topLeftSpan.end,V)}),la.push(H),la.push(T));else if(T.type===J.a.column){H=T;for(T=Object.assign(new m,{start:T.span.start,end:T.span.end,gv:[Object.assign(new f,{firstColumn:H.startIndex,Kuc:H.endIndex})]});T.end<V.length-1&&":"===V.charAt(T.end)&&ba<D.length-1;)if(H=D[ba+1].ref,H.type===J.a.column&&H.span.start===T.end+1){var S=H;
T.gv.push(Object.assign(new f,{firstColumn:S.startIndex,Kuc:S.endIndex}));T.end=H.span.end;ba++}else break;la.push(T)}else if(T.type===J.a.row){H=T;for(T=Object.assign(new c,{start:T.span.start,end:T.span.end,gv:[Object.assign(new e,{firstRow:H.startIndex,Luc:H.endIndex})]});T.end<V.length-1&&":"===V.charAt(T.end)&&ba<D.length-1;)if(H=D[ba+1].ref,H.type===J.a.row&&H.span.start===T.end+1)S=H,T.gv.push(Object.assign(new e,{firstRow:S.startIndex,Luc:S.endIndex})),T.end=H.span.end,ba++;else break;la.push(T)}}return la};
a.prototype.HJe=function(D,V,U){return!(D.start>U||V>D.end)};a.prototype.IJe=function(D,V,U){return!(D.start>U||V>D.end)};a.Tqf=function(D,V){return D.index<=V.index?D:V};a.ysf=function(D,V){return V||D?V&&D?2:!V&&D?3:0:1};Object(A.a)(a,"RelativeAndAbsoluteReferencesManager",null,[605])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/94e5ea840c65322ef8f6d562a1a5fc83/EwaDS.calc.js.map